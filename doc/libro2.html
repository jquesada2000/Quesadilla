<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Jose Antonio Quesada Rico" />

<meta name="date" content="2024-11-30" />

<title>Bioestadística Avanzada</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Bioestadística Avanzada</h1>
<h4 class="author">Jose Antonio Quesada Rico</h4>
<h4 class="date">2024-11-30</h4>



<p>En este documento se muestra el codigo R utilizado en el Libro
“Bioestadística Básica y Avanzada con R”, publicado por la Editorial
Diaz de Santos en 2024. Se incluye el codigo de la primera parte del
libro: II Bioestadística Avanzada.</p>
<div id="intalación-de-paquetes" class="section level2">
<h2>Intalación de paquetes</h2>
<p>Los siguientes paquetes son necesarios instalarlos:</p>
<p>install.packages(‘MixAll’)</p>
<p>install.packages(‘vcd’)</p>
<p>install.packages(‘gofgamma’)</p>
<p>install.packages(‘DAMisc’)</p>
<p>install.packages(‘car’)</p>
<p>install.packages(‘MixAll’)</p>
<p>install.packages(‘pscl’)</p>
<p>install.packages(‘asaur’)</p>
<p>install.packages(‘sandwich’)</p>
<p>install.packages(‘lmtest’)</p>
<p>install.packages(‘MASS’)</p>
<p>install.packages(‘car’)</p>
<p>install.packages(‘chest’)</p>
<p>install.packages(‘boot’)</p>
<p>install.packages(‘NHSRdatasets’)</p>
<p>install.packages(‘lme4’)</p>
<p>install.packages(‘medicaldata’)</p>
<p>install.packages(‘reshape2’)</p>
<p>install.packages(‘mgcv’)</p>
<p>install.packages(‘survival’)</p>
<p>install.packages(‘timereg’)</p>
<p>install.packages(‘asaur’)</p>
<p>install.packages(‘forcats’)</p>
<p>install.packages(‘tidyr’)</p>
<p>install.packages(‘tables’)</p>
<p>A continuacion se describe el codigo de cada subcapitulo del
Libro:</p>
</div>
<div id="regresión-de-poisson" class="section level2">
<h2>Regresión de Poisson</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(MixAll)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">data</span>(DebTrivedi)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> DebTrivedi</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> dataset<span class="sc">$</span>age<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="co"># test distribucion -----------------------------</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>x <span class="ot">&lt;-</span> dataset<span class="sc">$</span>ofp</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a><span class="fu">hist</span>(x)</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="fu">mean</span>(x)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="fu">min</span>(x)</span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" tabindex="-1"></a><span class="fu">library</span>(vcd) </span>
<span id="cb1-25"><a href="#cb1-25" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" tabindex="-1"></a>gf <span class="ot">=</span> <span class="fu">goodfit</span>(x,<span class="at">type=</span> <span class="st">&quot;poisson&quot;</span>,<span class="at">method=</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb1-27"><a href="#cb1-27" tabindex="-1"></a><span class="fu">summary</span>(gf)</span>
<span id="cb1-28"><a href="#cb1-28" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" tabindex="-1"></a>gf2 <span class="ot">=</span> <span class="fu">goodfit</span>(x,<span class="at">type=</span> <span class="st">&quot;nbinomial&quot;</span>,<span class="at">method=</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb1-31"><a href="#cb1-31" tabindex="-1"></a><span class="fu">summary</span>(gf2)</span>
<span id="cb1-32"><a href="#cb1-32" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" tabindex="-1"></a><span class="fu">library</span>(gofgamma) <span class="co"># no admite cero la gamma</span></span>
<span id="cb1-35"><a href="#cb1-35" tabindex="-1"></a><span class="fu">test.KS</span>(x, <span class="at">boot =</span> <span class="dv">500</span>, <span class="at">alpha =</span> <span class="fl">0.05</span>)</span>
<span id="cb1-36"><a href="#cb1-36" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" tabindex="-1"></a><span class="co"># -----------------------------------------------</span></span>
<span id="cb1-38"><a href="#cb1-38" tabindex="-1"></a></span>
<span id="cb1-39"><a href="#cb1-39" tabindex="-1"></a><span class="co"># change negative values to positive</span></span>
<span id="cb1-40"><a href="#cb1-40" tabindex="-1"></a>dataset<span class="sc">$</span>faminc <span class="ot">&lt;-</span> <span class="fu">abs</span>(dataset<span class="sc">$</span>faminc)</span>
<span id="cb1-41"><a href="#cb1-41" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" tabindex="-1"></a>fit.sat<span class="ot">&lt;-</span><span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb1-44"><a href="#cb1-44" tabindex="-1"></a>              </span>
<span id="cb1-45"><a href="#cb1-45" tabindex="-1"></a>              hosp <span class="sc">+</span> </span>
<span id="cb1-46"><a href="#cb1-46" tabindex="-1"></a>              health <span class="sc">+</span> </span>
<span id="cb1-47"><a href="#cb1-47" tabindex="-1"></a>              numchron <span class="sc">+</span> </span>
<span id="cb1-48"><a href="#cb1-48" tabindex="-1"></a>              adldiff <span class="sc">+</span> </span>
<span id="cb1-49"><a href="#cb1-49" tabindex="-1"></a>              region <span class="sc">+</span> </span>
<span id="cb1-50"><a href="#cb1-50" tabindex="-1"></a>              age <span class="sc">+</span> </span>
<span id="cb1-51"><a href="#cb1-51" tabindex="-1"></a>              black <span class="sc">+</span> </span>
<span id="cb1-52"><a href="#cb1-52" tabindex="-1"></a>              gender <span class="sc">+</span> </span>
<span id="cb1-53"><a href="#cb1-53" tabindex="-1"></a>              married <span class="sc">+</span></span>
<span id="cb1-54"><a href="#cb1-54" tabindex="-1"></a>              school <span class="sc">+</span> </span>
<span id="cb1-55"><a href="#cb1-55" tabindex="-1"></a>              faminc <span class="sc">+</span> </span>
<span id="cb1-56"><a href="#cb1-56" tabindex="-1"></a>              employed <span class="sc">+</span> </span>
<span id="cb1-57"><a href="#cb1-57" tabindex="-1"></a>              privins <span class="sc">+</span> </span>
<span id="cb1-58"><a href="#cb1-58" tabindex="-1"></a>              medicaid</span>
<span id="cb1-59"><a href="#cb1-59" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" tabindex="-1"></a>            ,<span class="at">family=</span>poisson, <span class="at">data=</span>dataset)</span>
<span id="cb1-61"><a href="#cb1-61" tabindex="-1"></a></span>
<span id="cb1-62"><a href="#cb1-62" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" tabindex="-1"></a><span class="fu">vif</span>(fit.sat)</span>
<span id="cb1-64"><a href="#cb1-64" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" tabindex="-1"></a></span>
<span id="cb1-66"><a href="#cb1-66" tabindex="-1"></a><span class="fu">drop1</span>(fit.sat,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb1-67"><a href="#cb1-67" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" tabindex="-1"></a></span>
<span id="cb1-69"><a href="#cb1-69" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb1-71"><a href="#cb1-71" tabindex="-1"></a>               </span>
<span id="cb1-72"><a href="#cb1-72" tabindex="-1"></a>               hosp <span class="sc">+</span> </span>
<span id="cb1-73"><a href="#cb1-73" tabindex="-1"></a>               health <span class="sc">+</span> </span>
<span id="cb1-74"><a href="#cb1-74" tabindex="-1"></a>               numchron <span class="sc">+</span> </span>
<span id="cb1-75"><a href="#cb1-75" tabindex="-1"></a>               adldiff <span class="sc">+</span> </span>
<span id="cb1-76"><a href="#cb1-76" tabindex="-1"></a>               region <span class="sc">+</span> </span>
<span id="cb1-77"><a href="#cb1-77" tabindex="-1"></a>               age <span class="sc">+</span> </span>
<span id="cb1-78"><a href="#cb1-78" tabindex="-1"></a>               black <span class="sc">+</span> </span>
<span id="cb1-79"><a href="#cb1-79" tabindex="-1"></a>               gender <span class="sc">+</span> </span>
<span id="cb1-80"><a href="#cb1-80" tabindex="-1"></a>               married <span class="sc">+</span></span>
<span id="cb1-81"><a href="#cb1-81" tabindex="-1"></a>               school <span class="sc">+</span> </span>
<span id="cb1-82"><a href="#cb1-82" tabindex="-1"></a>               <span class="co">#faminc + </span></span>
<span id="cb1-83"><a href="#cb1-83" tabindex="-1"></a>               employed <span class="sc">+</span> </span>
<span id="cb1-84"><a href="#cb1-84" tabindex="-1"></a>               privins <span class="sc">+</span> </span>
<span id="cb1-85"><a href="#cb1-85" tabindex="-1"></a>               medicaid</span>
<span id="cb1-86"><a href="#cb1-86" tabindex="-1"></a>             </span>
<span id="cb1-87"><a href="#cb1-87" tabindex="-1"></a>             ,<span class="at">family=</span>poisson, <span class="at">data=</span>dataset)</span>
<span id="cb1-88"><a href="#cb1-88" tabindex="-1"></a></span>
<span id="cb1-89"><a href="#cb1-89" tabindex="-1"></a></span>
<span id="cb1-90"><a href="#cb1-90" tabindex="-1"></a><span class="fu">drop1</span>(fit1,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb1-91"><a href="#cb1-91" tabindex="-1"></a></span>
<span id="cb1-92"><a href="#cb1-92" tabindex="-1"></a></span>
<span id="cb1-93"><a href="#cb1-93" tabindex="-1"></a><span class="co"># Sobredispersion</span></span>
<span id="cb1-94"><a href="#cb1-94" tabindex="-1"></a>Phi <span class="ot">&lt;-</span> fit1<span class="sc">$</span>deviance <span class="sc">/</span> (<span class="fu">nrow</span>(dataset)<span class="sc">-</span><span class="fu">length</span>(fit1<span class="sc">$</span>coefficients))</span>
<span id="cb1-95"><a href="#cb1-95" tabindex="-1"></a>Phi</span>
<span id="cb1-96"><a href="#cb1-96" tabindex="-1"></a></span>
<span id="cb1-97"><a href="#cb1-97" tabindex="-1"></a></span>
<span id="cb1-98"><a href="#cb1-98" tabindex="-1"></a><span class="fu">library</span>(DAMisc)</span>
<span id="cb1-99"><a href="#cb1-99" tabindex="-1"></a><span class="fu">poisGOF</span>(fit1)</span>
<span id="cb1-100"><a href="#cb1-100" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" tabindex="-1"></a></span>
<span id="cb1-102"><a href="#cb1-102" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" tabindex="-1"></a>fit1.q.sat <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb1-104"><a href="#cb1-104" tabindex="-1"></a>              </span>
<span id="cb1-105"><a href="#cb1-105" tabindex="-1"></a>              hosp <span class="sc">+</span> </span>
<span id="cb1-106"><a href="#cb1-106" tabindex="-1"></a>              health <span class="sc">+</span> </span>
<span id="cb1-107"><a href="#cb1-107" tabindex="-1"></a>              numchron <span class="sc">+</span> </span>
<span id="cb1-108"><a href="#cb1-108" tabindex="-1"></a>              adldiff <span class="sc">+</span> </span>
<span id="cb1-109"><a href="#cb1-109" tabindex="-1"></a>              region <span class="sc">+</span> </span>
<span id="cb1-110"><a href="#cb1-110" tabindex="-1"></a>              age <span class="sc">+</span> </span>
<span id="cb1-111"><a href="#cb1-111" tabindex="-1"></a>              black <span class="sc">+</span> </span>
<span id="cb1-112"><a href="#cb1-112" tabindex="-1"></a>              gender <span class="sc">+</span> </span>
<span id="cb1-113"><a href="#cb1-113" tabindex="-1"></a>              married <span class="sc">+</span></span>
<span id="cb1-114"><a href="#cb1-114" tabindex="-1"></a>              school <span class="sc">+</span> </span>
<span id="cb1-115"><a href="#cb1-115" tabindex="-1"></a>              <span class="co">#faminc + </span></span>
<span id="cb1-116"><a href="#cb1-116" tabindex="-1"></a>              employed <span class="sc">+</span> </span>
<span id="cb1-117"><a href="#cb1-117" tabindex="-1"></a>              privins <span class="sc">+</span> </span>
<span id="cb1-118"><a href="#cb1-118" tabindex="-1"></a>              medicaid</span>
<span id="cb1-119"><a href="#cb1-119" tabindex="-1"></a>            </span>
<span id="cb1-120"><a href="#cb1-120" tabindex="-1"></a>            ,<span class="at">family=</span><span class="fu">quasi</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>,<span class="at">variance=</span><span class="st">&quot;mu&quot;</span>), <span class="at">data=</span>dataset)</span>
<span id="cb1-121"><a href="#cb1-121" tabindex="-1"></a></span>
<span id="cb1-122"><a href="#cb1-122" tabindex="-1"></a></span>
<span id="cb1-123"><a href="#cb1-123" tabindex="-1"></a>fit1.q <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb1-124"><a href="#cb1-124" tabindex="-1"></a>              </span>
<span id="cb1-125"><a href="#cb1-125" tabindex="-1"></a>              hosp <span class="sc">+</span> </span>
<span id="cb1-126"><a href="#cb1-126" tabindex="-1"></a>              health <span class="sc">+</span> </span>
<span id="cb1-127"><a href="#cb1-127" tabindex="-1"></a>              numchron <span class="sc">+</span> </span>
<span id="cb1-128"><a href="#cb1-128" tabindex="-1"></a>              <span class="co">#adldiff + </span></span>
<span id="cb1-129"><a href="#cb1-129" tabindex="-1"></a>              region <span class="sc">+</span> </span>
<span id="cb1-130"><a href="#cb1-130" tabindex="-1"></a>              <span class="co">#age + </span></span>
<span id="cb1-131"><a href="#cb1-131" tabindex="-1"></a>              <span class="co">#black + </span></span>
<span id="cb1-132"><a href="#cb1-132" tabindex="-1"></a>              gender <span class="sc">+</span> </span>
<span id="cb1-133"><a href="#cb1-133" tabindex="-1"></a>              <span class="co">#married +</span></span>
<span id="cb1-134"><a href="#cb1-134" tabindex="-1"></a>              school <span class="sc">+</span> </span>
<span id="cb1-135"><a href="#cb1-135" tabindex="-1"></a>              <span class="co">#faminc + </span></span>
<span id="cb1-136"><a href="#cb1-136" tabindex="-1"></a>              <span class="co">#employed + </span></span>
<span id="cb1-137"><a href="#cb1-137" tabindex="-1"></a>              privins <span class="sc">+</span> </span>
<span id="cb1-138"><a href="#cb1-138" tabindex="-1"></a>              medicaid</span>
<span id="cb1-139"><a href="#cb1-139" tabindex="-1"></a>            </span>
<span id="cb1-140"><a href="#cb1-140" tabindex="-1"></a>            ,<span class="at">family=</span><span class="fu">quasi</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>,<span class="at">variance=</span><span class="st">&quot;mu&quot;</span>), <span class="at">data=</span>dataset)</span>
<span id="cb1-141"><a href="#cb1-141" tabindex="-1"></a></span>
<span id="cb1-142"><a href="#cb1-142" tabindex="-1"></a></span>
<span id="cb1-143"><a href="#cb1-143" tabindex="-1"></a><span class="fu">drop1</span>(fit1.q,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb1-144"><a href="#cb1-144" tabindex="-1"></a></span>
<span id="cb1-145"><a href="#cb1-145" tabindex="-1"></a><span class="fu">summary</span>(fit1.q)</span>
<span id="cb1-146"><a href="#cb1-146" tabindex="-1"></a></span>
<span id="cb1-147"><a href="#cb1-147" tabindex="-1"></a></span>
<span id="cb1-148"><a href="#cb1-148" tabindex="-1"></a></span>
<span id="cb1-149"><a href="#cb1-149" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit1.q)))</span>
<span id="cb1-150"><a href="#cb1-150" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">rownames</span>(marco)</span>
<span id="cb1-151"><a href="#cb1-151" tabindex="-1"></a>bethas<span class="ot">&lt;-</span>marco<span class="sc">$</span>Estimate</span>
<span id="cb1-152"><a href="#cb1-152" tabindex="-1"></a>error<span class="ot">&lt;-</span>marco<span class="sc">$</span>Std..Error</span>
<span id="cb1-153"><a href="#cb1-153" tabindex="-1"></a>valorp<span class="ot">&lt;-</span>marco<span class="sc">$</span>Pr...t..</span>
<span id="cb1-154"><a href="#cb1-154" tabindex="-1"></a></span>
<span id="cb1-155"><a href="#cb1-155" tabindex="-1"></a>RR<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">2</span>)</span>
<span id="cb1-156"><a href="#cb1-156" tabindex="-1"></a>aCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb1-157"><a href="#cb1-157" tabindex="-1"></a>bCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb1-158"><a href="#cb1-158" tabindex="-1"></a>(res_fit1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(labels,<span class="at">RR=</span>RR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI,<span class="st">&quot;-&quot;</span>,bCI,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span>
<span id="cb1-159"><a href="#cb1-159" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" tabindex="-1"></a></span>
<span id="cb1-161"><a href="#cb1-161" tabindex="-1"></a>dataset<span class="sc">$</span>health</span>
<span id="cb1-162"><a href="#cb1-162" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" tabindex="-1"></a>dataset<span class="sc">$</span>health <span class="ot">&lt;-</span> <span class="fu">relevel</span>(dataset<span class="sc">$</span>health, <span class="at">ref =</span> <span class="st">&quot;excellent&quot;</span>)</span>
<span id="cb1-164"><a href="#cb1-164" tabindex="-1"></a>dataset<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">relevel</span>(dataset<span class="sc">$</span>gender, <span class="at">ref =</span> <span class="st">&quot;male&quot;</span>)</span>
<span id="cb1-165"><a href="#cb1-165" tabindex="-1"></a></span>
<span id="cb1-166"><a href="#cb1-166" tabindex="-1"></a></span>
<span id="cb1-167"><a href="#cb1-167" tabindex="-1"></a>fit1.q <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb1-168"><a href="#cb1-168" tabindex="-1"></a>                </span>
<span id="cb1-169"><a href="#cb1-169" tabindex="-1"></a>                hosp <span class="sc">+</span> </span>
<span id="cb1-170"><a href="#cb1-170" tabindex="-1"></a>                health <span class="sc">+</span> </span>
<span id="cb1-171"><a href="#cb1-171" tabindex="-1"></a>                numchron <span class="sc">+</span> </span>
<span id="cb1-172"><a href="#cb1-172" tabindex="-1"></a>                <span class="co">#adldiff + </span></span>
<span id="cb1-173"><a href="#cb1-173" tabindex="-1"></a>                region <span class="sc">+</span> </span>
<span id="cb1-174"><a href="#cb1-174" tabindex="-1"></a>                <span class="co">#age + </span></span>
<span id="cb1-175"><a href="#cb1-175" tabindex="-1"></a>                <span class="co">#black + </span></span>
<span id="cb1-176"><a href="#cb1-176" tabindex="-1"></a>                gender <span class="sc">+</span> </span>
<span id="cb1-177"><a href="#cb1-177" tabindex="-1"></a>                <span class="co">#married +</span></span>
<span id="cb1-178"><a href="#cb1-178" tabindex="-1"></a>                school <span class="sc">+</span> </span>
<span id="cb1-179"><a href="#cb1-179" tabindex="-1"></a>                <span class="co">#faminc + </span></span>
<span id="cb1-180"><a href="#cb1-180" tabindex="-1"></a>                <span class="co">#employed + </span></span>
<span id="cb1-181"><a href="#cb1-181" tabindex="-1"></a>                privins <span class="sc">+</span> </span>
<span id="cb1-182"><a href="#cb1-182" tabindex="-1"></a>                medicaid</span>
<span id="cb1-183"><a href="#cb1-183" tabindex="-1"></a>              </span>
<span id="cb1-184"><a href="#cb1-184" tabindex="-1"></a>              ,<span class="at">family=</span><span class="fu">quasi</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>,<span class="at">variance=</span><span class="st">&quot;mu&quot;</span>), <span class="at">data=</span>dataset)</span>
<span id="cb1-185"><a href="#cb1-185" tabindex="-1"></a></span>
<span id="cb1-186"><a href="#cb1-186" tabindex="-1"></a></span>
<span id="cb1-187"><a href="#cb1-187" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit1.q)))</span>
<span id="cb1-188"><a href="#cb1-188" tabindex="-1"></a>labels<span class="ot">&lt;-</span><span class="fu">rownames</span>(marco)</span>
<span id="cb1-189"><a href="#cb1-189" tabindex="-1"></a>bethas<span class="ot">&lt;-</span>marco<span class="sc">$</span>Estimate</span>
<span id="cb1-190"><a href="#cb1-190" tabindex="-1"></a>error<span class="ot">&lt;-</span>marco<span class="sc">$</span>Std..Error</span>
<span id="cb1-191"><a href="#cb1-191" tabindex="-1"></a>valorp<span class="ot">&lt;-</span>marco<span class="sc">$</span>Pr...t..</span>
<span id="cb1-192"><a href="#cb1-192" tabindex="-1"></a></span>
<span id="cb1-193"><a href="#cb1-193" tabindex="-1"></a>RR<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">2</span>)</span>
<span id="cb1-194"><a href="#cb1-194" tabindex="-1"></a>aCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb1-195"><a href="#cb1-195" tabindex="-1"></a>bCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb1-196"><a href="#cb1-196" tabindex="-1"></a>(res_fit1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(labels,<span class="at">RR=</span>RR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI,<span class="st">&quot;-&quot;</span>,bCI,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span>
<span id="cb1-197"><a href="#cb1-197" tabindex="-1"></a></span>
<span id="cb1-198"><a href="#cb1-198" tabindex="-1"></a></span>
<span id="cb1-199"><a href="#cb1-199" tabindex="-1"></a>dataset<span class="sc">$</span>region</span></code></pre></div>
</div>
<div id="regresión-hurdle" class="section level2">
<h2>Regresión Hurdle</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="fu">library</span>(MixAll)</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="fu">data</span>(DebTrivedi)</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> DebTrivedi</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> dataset<span class="sc">$</span>age<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a></span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="fu">hist</span>(dataset<span class="sc">$</span>ofp)</span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a><span class="fu">table</span>(dataset<span class="sc">$</span>ofp)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a><span class="fu">sum</span>(dataset<span class="sc">$</span>ofp <span class="sc">==</span> <span class="dv">0</span>)<span class="sc">*</span><span class="dv">100</span><span class="sc">/</span><span class="fu">nrow</span>(dataset)</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a></span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="fu">library</span>(pscl)</span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a></span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>fit.hurdle.sat <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(ofp <span class="sc">~</span> </span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>                       </span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>                       hosp <span class="sc">+</span> </span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>                       health <span class="sc">+</span> </span>
<span id="cb2-34"><a href="#cb2-34" tabindex="-1"></a>                       numchron <span class="sc">+</span> </span>
<span id="cb2-35"><a href="#cb2-35" tabindex="-1"></a>                       adldiff <span class="sc">+</span> </span>
<span id="cb2-36"><a href="#cb2-36" tabindex="-1"></a>                       region <span class="sc">+</span> </span>
<span id="cb2-37"><a href="#cb2-37" tabindex="-1"></a>                       age <span class="sc">+</span> </span>
<span id="cb2-38"><a href="#cb2-38" tabindex="-1"></a>                       black <span class="sc">+</span> </span>
<span id="cb2-39"><a href="#cb2-39" tabindex="-1"></a>                       gender <span class="sc">+</span> </span>
<span id="cb2-40"><a href="#cb2-40" tabindex="-1"></a>                       married <span class="sc">+</span></span>
<span id="cb2-41"><a href="#cb2-41" tabindex="-1"></a>                       school <span class="sc">+</span> </span>
<span id="cb2-42"><a href="#cb2-42" tabindex="-1"></a>                       faminc <span class="sc">+</span> </span>
<span id="cb2-43"><a href="#cb2-43" tabindex="-1"></a>                       employed <span class="sc">+</span> </span>
<span id="cb2-44"><a href="#cb2-44" tabindex="-1"></a>                       privins <span class="sc">+</span> </span>
<span id="cb2-45"><a href="#cb2-45" tabindex="-1"></a>                       medicaid</span>
<span id="cb2-46"><a href="#cb2-46" tabindex="-1"></a>                     </span>
<span id="cb2-47"><a href="#cb2-47" tabindex="-1"></a>                     ,<span class="at">dist=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">zero.dist=</span><span class="st">&quot;binomial&quot;</span>, <span class="at">data=</span>dataset)</span>
<span id="cb2-48"><a href="#cb2-48" tabindex="-1"></a>  </span>
<span id="cb2-49"><a href="#cb2-49" tabindex="-1"></a></span>
<span id="cb2-50"><a href="#cb2-50" tabindex="-1"></a><span class="fu">drop1</span>(fit.hurdle.sat,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb2-51"><a href="#cb2-51" tabindex="-1"></a>  </span>
<span id="cb2-52"><a href="#cb2-52" tabindex="-1"></a><span class="fu">summary</span>(fit.hurdle.sat)</span>
<span id="cb2-53"><a href="#cb2-53" tabindex="-1"></a>  </span>
<span id="cb2-54"><a href="#cb2-54" tabindex="-1"></a>  </span>
<span id="cb2-55"><a href="#cb2-55" tabindex="-1"></a>  </span>
<span id="cb2-56"><a href="#cb2-56" tabindex="-1"></a>fit1.hurdle <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(ofp <span class="sc">~</span> </span>
<span id="cb2-57"><a href="#cb2-57" tabindex="-1"></a>                           </span>
<span id="cb2-58"><a href="#cb2-58" tabindex="-1"></a>                           hosp <span class="sc">+</span> </span>
<span id="cb2-59"><a href="#cb2-59" tabindex="-1"></a>                           health <span class="sc">+</span> </span>
<span id="cb2-60"><a href="#cb2-60" tabindex="-1"></a>                           numchron <span class="sc">+</span> </span>
<span id="cb2-61"><a href="#cb2-61" tabindex="-1"></a>                           adldiff <span class="sc">+</span> </span>
<span id="cb2-62"><a href="#cb2-62" tabindex="-1"></a>                           region <span class="sc">+</span> </span>
<span id="cb2-63"><a href="#cb2-63" tabindex="-1"></a>                           age <span class="sc">+</span> </span>
<span id="cb2-64"><a href="#cb2-64" tabindex="-1"></a>                           black <span class="sc">+</span> </span>
<span id="cb2-65"><a href="#cb2-65" tabindex="-1"></a>                           gender <span class="sc">+</span> </span>
<span id="cb2-66"><a href="#cb2-66" tabindex="-1"></a>                           married <span class="sc">+</span></span>
<span id="cb2-67"><a href="#cb2-67" tabindex="-1"></a>                           school <span class="sc">+</span> </span>
<span id="cb2-68"><a href="#cb2-68" tabindex="-1"></a>                           <span class="co">#faminc + </span></span>
<span id="cb2-69"><a href="#cb2-69" tabindex="-1"></a>                           <span class="co">#employed + </span></span>
<span id="cb2-70"><a href="#cb2-70" tabindex="-1"></a>                           privins <span class="sc">+</span> </span>
<span id="cb2-71"><a href="#cb2-71" tabindex="-1"></a>                           medicaid</span>
<span id="cb2-72"><a href="#cb2-72" tabindex="-1"></a>                         </span>
<span id="cb2-73"><a href="#cb2-73" tabindex="-1"></a>                         ,<span class="at">dist=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">zero.dist=</span><span class="st">&quot;binomial&quot;</span>, <span class="at">data=</span>dataset)</span>
<span id="cb2-74"><a href="#cb2-74" tabindex="-1"></a></span>
<span id="cb2-75"><a href="#cb2-75" tabindex="-1"></a></span>
<span id="cb2-76"><a href="#cb2-76" tabindex="-1"></a><span class="fu">drop1</span>(fit1.hurdle,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb2-77"><a href="#cb2-77" tabindex="-1"></a>  </span>
<span id="cb2-78"><a href="#cb2-78" tabindex="-1"></a>  </span>
<span id="cb2-79"><a href="#cb2-79" tabindex="-1"></a><span class="fu">summary</span>(fit1.hurdle)</span>
<span id="cb2-80"><a href="#cb2-80" tabindex="-1"></a>  </span>
<span id="cb2-81"><a href="#cb2-81" tabindex="-1"></a>  </span>
<span id="cb2-82"><a href="#cb2-82" tabindex="-1"></a>  <span class="fu">AIC</span>(fit1.hurdle)</span>
<span id="cb2-83"><a href="#cb2-83" tabindex="-1"></a>  </span>
<span id="cb2-84"><a href="#cb2-84" tabindex="-1"></a>  </span>
<span id="cb2-85"><a href="#cb2-85" tabindex="-1"></a>  </span>
<span id="cb2-86"><a href="#cb2-86" tabindex="-1"></a>  dataset<span class="sc">$</span>health <span class="ot">&lt;-</span> <span class="fu">relevel</span>(dataset<span class="sc">$</span>health, <span class="at">ref =</span> <span class="st">&quot;excellent&quot;</span>)</span>
<span id="cb2-87"><a href="#cb2-87" tabindex="-1"></a>  dataset<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">relevel</span>(dataset<span class="sc">$</span>gender, <span class="at">ref =</span> <span class="st">&quot;male&quot;</span>)</span>
<span id="cb2-88"><a href="#cb2-88" tabindex="-1"></a>  </span>
<span id="cb2-89"><a href="#cb2-89" tabindex="-1"></a></span>
<span id="cb2-90"><a href="#cb2-90" tabindex="-1"></a>  fit2.hurdle <span class="ot">&lt;-</span> <span class="fu">hurdle</span>(ofp <span class="sc">~</span> </span>
<span id="cb2-91"><a href="#cb2-91" tabindex="-1"></a>                          </span>
<span id="cb2-92"><a href="#cb2-92" tabindex="-1"></a>                          hosp <span class="sc">+</span> </span>
<span id="cb2-93"><a href="#cb2-93" tabindex="-1"></a>                          health <span class="sc">+</span> </span>
<span id="cb2-94"><a href="#cb2-94" tabindex="-1"></a>                          numchron <span class="sc">+</span> </span>
<span id="cb2-95"><a href="#cb2-95" tabindex="-1"></a>                          adldiff <span class="sc">+</span> </span>
<span id="cb2-96"><a href="#cb2-96" tabindex="-1"></a>                          region <span class="sc">+</span> </span>
<span id="cb2-97"><a href="#cb2-97" tabindex="-1"></a>                          age <span class="sc">+</span> </span>
<span id="cb2-98"><a href="#cb2-98" tabindex="-1"></a>                          <span class="co">#black + </span></span>
<span id="cb2-99"><a href="#cb2-99" tabindex="-1"></a>                          <span class="co">#gender + </span></span>
<span id="cb2-100"><a href="#cb2-100" tabindex="-1"></a>                          married <span class="sc">+</span></span>
<span id="cb2-101"><a href="#cb2-101" tabindex="-1"></a>                          school <span class="sc">+</span> </span>
<span id="cb2-102"><a href="#cb2-102" tabindex="-1"></a>                          <span class="co">#faminc + </span></span>
<span id="cb2-103"><a href="#cb2-103" tabindex="-1"></a>                          <span class="co">#employed + </span></span>
<span id="cb2-104"><a href="#cb2-104" tabindex="-1"></a>                          privins <span class="sc">+</span> </span>
<span id="cb2-105"><a href="#cb2-105" tabindex="-1"></a>                          medicaid <span class="sc">|</span></span>
<span id="cb2-106"><a href="#cb2-106" tabindex="-1"></a>                          </span>
<span id="cb2-107"><a href="#cb2-107" tabindex="-1"></a>                          hosp <span class="sc">+</span> </span>
<span id="cb2-108"><a href="#cb2-108" tabindex="-1"></a>                          health <span class="sc">+</span> </span>
<span id="cb2-109"><a href="#cb2-109" tabindex="-1"></a>                          numchron <span class="sc">+</span> </span>
<span id="cb2-110"><a href="#cb2-110" tabindex="-1"></a>                          <span class="co">#adldiff + </span></span>
<span id="cb2-111"><a href="#cb2-111" tabindex="-1"></a>                          <span class="co">#region + </span></span>
<span id="cb2-112"><a href="#cb2-112" tabindex="-1"></a>                          age <span class="sc">+</span> </span>
<span id="cb2-113"><a href="#cb2-113" tabindex="-1"></a>                          black <span class="sc">+</span> </span>
<span id="cb2-114"><a href="#cb2-114" tabindex="-1"></a>                          gender <span class="sc">+</span> </span>
<span id="cb2-115"><a href="#cb2-115" tabindex="-1"></a>                          married <span class="sc">+</span></span>
<span id="cb2-116"><a href="#cb2-116" tabindex="-1"></a>                          school <span class="sc">+</span> </span>
<span id="cb2-117"><a href="#cb2-117" tabindex="-1"></a>                          <span class="co">#faminc + </span></span>
<span id="cb2-118"><a href="#cb2-118" tabindex="-1"></a>                          <span class="co">#employed + </span></span>
<span id="cb2-119"><a href="#cb2-119" tabindex="-1"></a>                          privins <span class="sc">+</span> </span>
<span id="cb2-120"><a href="#cb2-120" tabindex="-1"></a>                          medicaid </span>
<span id="cb2-121"><a href="#cb2-121" tabindex="-1"></a>                        </span>
<span id="cb2-122"><a href="#cb2-122" tabindex="-1"></a>                        ,<span class="at">dist=</span><span class="st">&quot;poisson&quot;</span>,<span class="at">zero.dist=</span><span class="st">&quot;binomial&quot;</span>, <span class="at">data=</span>dataset)</span>
<span id="cb2-123"><a href="#cb2-123" tabindex="-1"></a>  </span>
<span id="cb2-124"><a href="#cb2-124" tabindex="-1"></a>  </span>
<span id="cb2-125"><a href="#cb2-125" tabindex="-1"></a>  </span>
<span id="cb2-126"><a href="#cb2-126" tabindex="-1"></a>  <span class="fu">AIC</span>(fit1.hurdle,fit2.hurdle)</span>
<span id="cb2-127"><a href="#cb2-127" tabindex="-1"></a>  </span>
<span id="cb2-128"><a href="#cb2-128" tabindex="-1"></a>  <span class="fu">summary</span>(fit2.hurdle)</span>
<span id="cb2-129"><a href="#cb2-129" tabindex="-1"></a>  </span>
<span id="cb2-130"><a href="#cb2-130" tabindex="-1"></a>  </span>
<span id="cb2-131"><a href="#cb2-131" tabindex="-1"></a>  </span>
<span id="cb2-132"><a href="#cb2-132" tabindex="-1"></a>  </span>
<span id="cb2-133"><a href="#cb2-133" tabindex="-1"></a>  marco.pois <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit2.hurdle))<span class="sc">$</span>count)</span>
<span id="cb2-134"><a href="#cb2-134" tabindex="-1"></a>  marco.bin <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit2.hurdle))<span class="sc">$</span>zero)</span>
<span id="cb2-135"><a href="#cb2-135" tabindex="-1"></a>  </span>
<span id="cb2-136"><a href="#cb2-136" tabindex="-1"></a>  </span>
<span id="cb2-137"><a href="#cb2-137" tabindex="-1"></a>  labels<span class="ot">&lt;-</span><span class="fu">rownames</span>(marco.pois)</span>
<span id="cb2-138"><a href="#cb2-138" tabindex="-1"></a>  bethas<span class="ot">&lt;-</span>marco.pois<span class="sc">$</span>Estimate</span>
<span id="cb2-139"><a href="#cb2-139" tabindex="-1"></a>  error<span class="ot">&lt;-</span>marco.pois<span class="sc">$</span>Std..Error</span>
<span id="cb2-140"><a href="#cb2-140" tabindex="-1"></a>  valorp<span class="ot">&lt;-</span>marco.pois<span class="sc">$</span>Pr...z..</span>
<span id="cb2-141"><a href="#cb2-141" tabindex="-1"></a>  </span>
<span id="cb2-142"><a href="#cb2-142" tabindex="-1"></a>  RR<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">2</span>)</span>
<span id="cb2-143"><a href="#cb2-143" tabindex="-1"></a>  aCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb2-144"><a href="#cb2-144" tabindex="-1"></a>  bCI<span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb2-145"><a href="#cb2-145" tabindex="-1"></a>  (res_fit1<span class="ot">&lt;-</span><span class="fu">data.frame</span>(labels,<span class="at">RR=</span>RR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI,<span class="st">&quot;-&quot;</span>,bCI,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span>
<span id="cb2-146"><a href="#cb2-146" tabindex="-1"></a>  </span>
<span id="cb2-147"><a href="#cb2-147" tabindex="-1"></a>  </span>
<span id="cb2-148"><a href="#cb2-148" tabindex="-1"></a>  labels2 <span class="ot">&lt;-</span><span class="fu">rownames</span>(marco.bin)</span>
<span id="cb2-149"><a href="#cb2-149" tabindex="-1"></a>  bethas2 <span class="ot">&lt;-</span>marco.bin<span class="sc">$</span>Estimate</span>
<span id="cb2-150"><a href="#cb2-150" tabindex="-1"></a>  error2 <span class="ot">&lt;-</span>marco.bin<span class="sc">$</span>Std..Error</span>
<span id="cb2-151"><a href="#cb2-151" tabindex="-1"></a>  valorp2 <span class="ot">&lt;-</span>marco.bin<span class="sc">$</span>Pr...z..</span>
<span id="cb2-152"><a href="#cb2-152" tabindex="-1"></a>  </span>
<span id="cb2-153"><a href="#cb2-153" tabindex="-1"></a>  OR <span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas2),<span class="dv">2</span>)</span>
<span id="cb2-154"><a href="#cb2-154" tabindex="-1"></a>  aCI2 <span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas2<span class="fl">-1.96</span><span class="sc">*</span>error2),<span class="dv">2</span>)</span>
<span id="cb2-155"><a href="#cb2-155" tabindex="-1"></a>  bCI2 <span class="ot">&lt;-</span><span class="fu">round</span>(<span class="fu">exp</span>(bethas2<span class="fl">+1.96</span><span class="sc">*</span>error2),<span class="dv">2</span>)</span>
<span id="cb2-156"><a href="#cb2-156" tabindex="-1"></a>  (res_fit2<span class="ot">&lt;-</span><span class="fu">data.frame</span>(labels2,<span class="at">OR=</span>OR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI2,<span class="st">&quot;-&quot;</span>,bCI2,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp2,<span class="dv">3</span>)))</span>
<span id="cb2-157"><a href="#cb2-157" tabindex="-1"></a>  </span>
<span id="cb2-158"><a href="#cb2-158" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="regresión-de-poission-con-varianza-robusta" class="section level2">
<h2>Regresión de Poission con varianza robusta</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="fu">library</span>(asaur)</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pharmacoSmoking&quot;</span>)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a><span class="fu">head</span>(pharmacoSmoking)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">names</span>(pharmacoSmoking)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> pharmacoSmoking[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">11</span>,<span class="dv">12</span>)]</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb3-14"><a href="#cb3-14" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" tabindex="-1"></a><span class="do">## logistic model --------------------------------</span></span>
<span id="cb3-16"><a href="#cb3-16" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" tabindex="-1"></a>fit.bin <span class="ot">&lt;-</span> <span class="fu">glm</span>(relapse <span class="sc">~</span> </span>
<span id="cb3-18"><a href="#cb3-18" tabindex="-1"></a>                   grp <span class="sc">+</span> </span>
<span id="cb3-19"><a href="#cb3-19" tabindex="-1"></a>                   age </span>
<span id="cb3-20"><a href="#cb3-20" tabindex="-1"></a>                   <span class="co">#gender + </span></span>
<span id="cb3-21"><a href="#cb3-21" tabindex="-1"></a>                   <span class="co">#race + </span></span>
<span id="cb3-22"><a href="#cb3-22" tabindex="-1"></a>                   <span class="co">#employment </span></span>
<span id="cb3-23"><a href="#cb3-23" tabindex="-1"></a>                   <span class="co">#yearsSmoking + </span></span>
<span id="cb3-24"><a href="#cb3-24" tabindex="-1"></a>                   <span class="co">#levelSmoking + </span></span>
<span id="cb3-25"><a href="#cb3-25" tabindex="-1"></a>                   <span class="co">#priorAttempts </span></span>
<span id="cb3-26"><a href="#cb3-26" tabindex="-1"></a>                   <span class="co">#longestNoSmoke</span></span>
<span id="cb3-27"><a href="#cb3-27" tabindex="-1"></a>                 , <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>dataset)</span>
<span id="cb3-28"><a href="#cb3-28" tabindex="-1"></a></span>
<span id="cb3-29"><a href="#cb3-29" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit.bin)))</span>
<span id="cb3-32"><a href="#cb3-32" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(marco)</span>
<span id="cb3-33"><a href="#cb3-33" tabindex="-1"></a>bethas <span class="ot">&lt;-</span> marco<span class="sc">$</span>Estimate</span>
<span id="cb3-34"><a href="#cb3-34" tabindex="-1"></a>error <span class="ot">&lt;-</span> marco<span class="sc">$</span>Std..Error</span>
<span id="cb3-35"><a href="#cb3-35" tabindex="-1"></a>valorp <span class="ot">&lt;-</span> marco<span class="sc">$</span>Pr...z..</span>
<span id="cb3-36"><a href="#cb3-36" tabindex="-1"></a></span>
<span id="cb3-37"><a href="#cb3-37" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">2</span>)</span>
<span id="cb3-38"><a href="#cb3-38" tabindex="-1"></a>aCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb3-39"><a href="#cb3-39" tabindex="-1"></a>bCI <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">2</span>)</span>
<span id="cb3-40"><a href="#cb3-40" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" tabindex="-1"></a>(res_fit.bin<span class="ot">&lt;-</span><span class="fu">data.frame</span>(labels,<span class="at">OR=</span>OR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI,<span class="st">&quot;-&quot;</span>,bCI,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span>
<span id="cb3-42"><a href="#cb3-42" tabindex="-1"></a></span>
<span id="cb3-43"><a href="#cb3-43" tabindex="-1"></a></span>
<span id="cb3-44"><a href="#cb3-44" tabindex="-1"></a></span>
<span id="cb3-45"><a href="#cb3-45" tabindex="-1"></a><span class="do">## poisson model with robust variance -------------------</span></span>
<span id="cb3-46"><a href="#cb3-46" tabindex="-1"></a></span>
<span id="cb3-47"><a href="#cb3-47" tabindex="-1"></a><span class="fu">library</span>(sandwich) <span class="co"># to get robust estimators</span></span>
<span id="cb3-48"><a href="#cb3-48" tabindex="-1"></a><span class="fu">library</span>(lmtest) <span class="co"># to test coefficients</span></span>
<span id="cb3-49"><a href="#cb3-49" tabindex="-1"></a></span>
<span id="cb3-50"><a href="#cb3-50" tabindex="-1"></a></span>
<span id="cb3-51"><a href="#cb3-51" tabindex="-1"></a>fit.pois <span class="ot">&lt;-</span> <span class="fu">glm</span>(relapse <span class="sc">~</span> </span>
<span id="cb3-52"><a href="#cb3-52" tabindex="-1"></a>                  grp <span class="sc">+</span> </span>
<span id="cb3-53"><a href="#cb3-53" tabindex="-1"></a>                  age </span>
<span id="cb3-54"><a href="#cb3-54" tabindex="-1"></a>                </span>
<span id="cb3-55"><a href="#cb3-55" tabindex="-1"></a>                , <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">&quot;log&quot;</span>), <span class="at">data =</span> dataset)</span>
<span id="cb3-56"><a href="#cb3-56" tabindex="-1"></a></span>
<span id="cb3-57"><a href="#cb3-57" tabindex="-1"></a></span>
<span id="cb3-58"><a href="#cb3-58" tabindex="-1"></a></span>
<span id="cb3-59"><a href="#cb3-59" tabindex="-1"></a>fit.pois.robust <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(fit.pois, <span class="at">vcov =</span> sandwich)</span>
<span id="cb3-60"><a href="#cb3-60" tabindex="-1"></a></span>
<span id="cb3-61"><a href="#cb3-61" tabindex="-1"></a></span>
<span id="cb3-62"><a href="#cb3-62" tabindex="-1"></a>labels2 <span class="ot">&lt;-</span> <span class="fu">rownames</span>(fit.pois.robust)</span>
<span id="cb3-63"><a href="#cb3-63" tabindex="-1"></a>bethas2 <span class="ot">&lt;-</span> fit.pois.robust[,<span class="dv">1</span>]</span>
<span id="cb3-64"><a href="#cb3-64" tabindex="-1"></a>error2 <span class="ot">&lt;-</span> fit.pois.robust[,<span class="dv">2</span>]</span>
<span id="cb3-65"><a href="#cb3-65" tabindex="-1"></a>valorp2 <span class="ot">&lt;-</span> <span class="fu">round</span>(fit.pois.robust[,<span class="dv">4</span>],<span class="dv">3</span>)</span>
<span id="cb3-66"><a href="#cb3-66" tabindex="-1"></a></span>
<span id="cb3-67"><a href="#cb3-67" tabindex="-1"></a>RR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas2),<span class="dv">2</span>)</span>
<span id="cb3-68"><a href="#cb3-68" tabindex="-1"></a>aCI2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas2 <span class="sc">-</span> <span class="fl">1.96</span><span class="sc">*</span>error2),<span class="dv">2</span>)</span>
<span id="cb3-69"><a href="#cb3-69" tabindex="-1"></a>bCI2 <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas2 <span class="sc">+</span> <span class="fl">1.96</span><span class="sc">*</span>error2),<span class="dv">2</span>)</span>
<span id="cb3-70"><a href="#cb3-70" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" tabindex="-1"></a>(res_fit.pois <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(labels,<span class="at">RR=</span>RR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,aCI2,<span class="st">&quot;-&quot;</span>,bCI2,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalue=</span><span class="fu">round</span>(valorp2,<span class="dv">3</span>)))</span>
<span id="cb3-72"><a href="#cb3-72" tabindex="-1"></a></span>
<span id="cb3-73"><a href="#cb3-73" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" tabindex="-1"></a></span>
<span id="cb3-75"><a href="#cb3-75" tabindex="-1"></a><span class="fu">table</span>(dataset<span class="sc">$</span>relapse)</span></code></pre></div>
</div>
<div id="regresión-gamma" class="section level2">
<h2>Regresión Gamma</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Pima.te&quot;</span>)</span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;Pima.tr&quot;</span>)</span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">rbind</span>(Pima.te,Pima.tr)</span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a></span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="fu">head</span>(dataset)</span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="fu">hist</span>(dataset<span class="sc">$</span>ped)</span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" tabindex="-1"></a><span class="fu">min</span>(dataset<span class="sc">$</span>ped)</span>
<span id="cb4-17"><a href="#cb4-17" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" tabindex="-1"></a><span class="co"># test gamma ------------------------------------------</span></span>
<span id="cb4-22"><a href="#cb4-22" tabindex="-1"></a><span class="fu">library</span>(vcd)</span>
<span id="cb4-23"><a href="#cb4-23" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" tabindex="-1"></a><span class="fu">fitdistr</span>(dataset<span class="sc">$</span>ped, <span class="st">&quot;gamma&quot;</span>)</span>
<span id="cb4-25"><a href="#cb4-25" tabindex="-1"></a></span>
<span id="cb4-26"><a href="#cb4-26" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">density</span>(dataset<span class="sc">$</span>ped))</span>
<span id="cb4-27"><a href="#cb4-27" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" tabindex="-1"></a>med <span class="ot">&lt;-</span> <span class="fu">mean</span>(dataset<span class="sc">$</span>ped, <span class="at">na.rm=</span>T)</span>
<span id="cb4-29"><a href="#cb4-29" tabindex="-1"></a>sdd <span class="ot">&lt;-</span> <span class="fu">sd</span>(dataset<span class="sc">$</span>ped, <span class="at">na.rm=</span>T)</span>
<span id="cb4-30"><a href="#cb4-30" tabindex="-1"></a></span>
<span id="cb4-31"><a href="#cb4-31" tabindex="-1"></a><span class="co"># shape=alfa; scale=beta</span></span>
<span id="cb4-32"><a href="#cb4-32" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" tabindex="-1"></a><span class="fu">ks.test</span> ( dataset<span class="sc">$</span>ped, <span class="st">&quot;pgamma&quot;</span>, <span class="at">shape=</span><span class="fl">2.6</span> ,<span class="at">scale=</span> <span class="fl">5.2</span>, <span class="at">exact =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-34"><a href="#cb4-34" tabindex="-1"></a><span class="fu">ks.test</span> ( dataset<span class="sc">$</span>ped, <span class="st">&quot;pgamma&quot;</span>,  <span class="at">exact =</span> <span class="cn">FALSE</span>)</span>
<span id="cb4-35"><a href="#cb4-35" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" tabindex="-1"></a><span class="co"># ---------------------------------------------------------</span></span>
<span id="cb4-37"><a href="#cb4-37" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" tabindex="-1"></a></span>
<span id="cb4-39"><a href="#cb4-39" tabindex="-1"></a></span>
<span id="cb4-40"><a href="#cb4-40" tabindex="-1"></a></span>
<span id="cb4-41"><a href="#cb4-41" tabindex="-1"></a>fit.gamma.sat <span class="ot">&lt;-</span> <span class="fu">glm</span>(ped <span class="sc">~</span>  </span>
<span id="cb4-42"><a href="#cb4-42" tabindex="-1"></a>                  </span>
<span id="cb4-43"><a href="#cb4-43" tabindex="-1"></a>                  type <span class="sc">+</span></span>
<span id="cb4-44"><a href="#cb4-44" tabindex="-1"></a>                  npreg <span class="sc">+</span></span>
<span id="cb4-45"><a href="#cb4-45" tabindex="-1"></a>                  glu <span class="sc">+</span></span>
<span id="cb4-46"><a href="#cb4-46" tabindex="-1"></a>                  bp <span class="sc">+</span></span>
<span id="cb4-47"><a href="#cb4-47" tabindex="-1"></a>                  skin <span class="sc">+</span></span>
<span id="cb4-48"><a href="#cb4-48" tabindex="-1"></a>                  bmi <span class="sc">+</span></span>
<span id="cb4-49"><a href="#cb4-49" tabindex="-1"></a>                  age </span>
<span id="cb4-50"><a href="#cb4-50" tabindex="-1"></a>               </span>
<span id="cb4-51"><a href="#cb4-51" tabindex="-1"></a>                , <span class="at">family=</span><span class="fu">Gamma</span> (<span class="at">link=</span><span class="st">&quot;log&quot;</span>),<span class="at">data=</span>dataset)</span>
<span id="cb4-52"><a href="#cb4-52" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" tabindex="-1"></a><span class="fu">vif</span>(fit.gamma.sat)</span>
<span id="cb4-54"><a href="#cb4-54" tabindex="-1"></a><span class="fu">drop1</span>(fit.gamma.sat,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb4-55"><a href="#cb4-55" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" tabindex="-1"></a></span>
<span id="cb4-57"><a href="#cb4-57" tabindex="-1"></a></span>
<span id="cb4-58"><a href="#cb4-58" tabindex="-1"></a>fit1.gamma <span class="ot">&lt;-</span> <span class="fu">glm</span>(ped <span class="sc">~</span>  </span>
<span id="cb4-59"><a href="#cb4-59" tabindex="-1"></a>                       </span>
<span id="cb4-60"><a href="#cb4-60" tabindex="-1"></a>                       type <span class="sc">+</span></span>
<span id="cb4-61"><a href="#cb4-61" tabindex="-1"></a>                       <span class="co">#npreg </span></span>
<span id="cb4-62"><a href="#cb4-62" tabindex="-1"></a>                       glu </span>
<span id="cb4-63"><a href="#cb4-63" tabindex="-1"></a>                       <span class="co">#bp </span></span>
<span id="cb4-64"><a href="#cb4-64" tabindex="-1"></a>                       <span class="co">#skin </span></span>
<span id="cb4-65"><a href="#cb4-65" tabindex="-1"></a>                       <span class="co">#bmi </span></span>
<span id="cb4-66"><a href="#cb4-66" tabindex="-1"></a>                       <span class="co">#age </span></span>
<span id="cb4-67"><a href="#cb4-67" tabindex="-1"></a>                     </span>
<span id="cb4-68"><a href="#cb4-68" tabindex="-1"></a>                     , <span class="at">family=</span><span class="fu">Gamma</span> (<span class="at">link=</span><span class="st">&quot;log&quot;</span>),<span class="at">data=</span>dataset)</span>
<span id="cb4-69"><a href="#cb4-69" tabindex="-1"></a></span>
<span id="cb4-70"><a href="#cb4-70" tabindex="-1"></a></span>
<span id="cb4-71"><a href="#cb4-71" tabindex="-1"></a><span class="co">#drop1(fit1.gamma,test=&quot;Chisq&quot;)</span></span>
<span id="cb4-72"><a href="#cb4-72" tabindex="-1"></a><span class="fu">summary</span>(fit1.gamma)</span>
<span id="cb4-73"><a href="#cb4-73" tabindex="-1"></a></span>
<span id="cb4-74"><a href="#cb4-74" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb4-75"><a href="#cb4-75" tabindex="-1"></a><span class="fu">library</span>(chest)</span>
<span id="cb4-76"><a href="#cb4-76" tabindex="-1"></a></span>
<span id="cb4-77"><a href="#cb4-77" tabindex="-1"></a><span class="co"># list of possibly confounding variables</span></span>
<span id="cb4-78"><a href="#cb4-78" tabindex="-1"></a>vlist<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;npreg&quot;</span>, <span class="st">&quot;glu&quot;</span>, <span class="st">&quot;bp&quot;</span>, <span class="st">&quot;skin&quot;</span>,<span class="st">&quot;age&quot;</span>) </span>
<span id="cb4-79"><a href="#cb4-79" tabindex="-1"></a></span>
<span id="cb4-80"><a href="#cb4-80" tabindex="-1"></a></span>
<span id="cb4-81"><a href="#cb4-81" tabindex="-1"></a>results_grp <span class="ot">&lt;-</span> <span class="fu">chest_glm</span>(<span class="at">crude =</span> <span class="st">&quot;ped ~ type + bmi&quot;</span>, <span class="at">xlist =</span> vlist, <span class="at">data =</span> dataset, <span class="at">family =</span> <span class="fu">Gamma</span> (<span class="at">link=</span><span class="st">&quot;log&quot;</span>)) </span>
<span id="cb4-82"><a href="#cb4-82" tabindex="-1"></a></span>
<span id="cb4-83"><a href="#cb4-83" tabindex="-1"></a></span>
<span id="cb4-84"><a href="#cb4-84" tabindex="-1"></a><span class="fu">chest_plot</span>(results_grp)</span>
<span id="cb4-85"><a href="#cb4-85" tabindex="-1"></a><span class="co"># ---------------------------------------------------</span></span>
<span id="cb4-86"><a href="#cb4-86" tabindex="-1"></a></span>
<span id="cb4-87"><a href="#cb4-87" tabindex="-1"></a><span class="co"># bondad de ajuste</span></span>
<span id="cb4-88"><a href="#cb4-88" tabindex="-1"></a>res <span class="ot">&lt;-</span> <span class="fu">summary</span>(fit1.gamma)</span>
<span id="cb4-89"><a href="#cb4-89" tabindex="-1"></a>(devian <span class="ot">&lt;-</span> res<span class="sc">$</span>deviance)</span>
<span id="cb4-90"><a href="#cb4-90" tabindex="-1"></a>dff <span class="ot">&lt;-</span> res<span class="sc">$</span>df.residual</span>
<span id="cb4-91"><a href="#cb4-91" tabindex="-1"></a><span class="fu">pchisq</span>(devian,dff) <span class="co"># DEVIANCE=1187, pvalor = 0 ; modelo ajusta bien a los datos</span></span>
<span id="cb4-92"><a href="#cb4-92" tabindex="-1"></a></span>
<span id="cb4-93"><a href="#cb4-93" tabindex="-1"></a></span>
<span id="cb4-94"><a href="#cb4-94" tabindex="-1"></a></span>
<span id="cb4-95"><a href="#cb4-95" tabindex="-1"></a><span class="co"># interpretacion</span></span>
<span id="cb4-96"><a href="#cb4-96" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="fu">exp</span>(<span class="fu">coef</span>(fit.step.gama)))  <span class="co"># para estreñimiento = 0.9069</span></span>
<span id="cb4-97"><a href="#cb4-97" tabindex="-1"></a><span class="co"># si estreñimiento=si la media aritmetica de EVA original es 0.9069 veces mayor comparado con estreñimiento=no</span></span>
<span id="cb4-98"><a href="#cb4-98" tabindex="-1"></a><span class="co"># es lo mismo que EVA se reduce un 9,3% en los estreñimiento=si</span></span>
<span id="cb4-99"><a href="#cb4-99" tabindex="-1"></a></span>
<span id="cb4-100"><a href="#cb4-100" tabindex="-1"></a></span>
<span id="cb4-101"><a href="#cb4-101" tabindex="-1"></a></span>
<span id="cb4-102"><a href="#cb4-102" tabindex="-1"></a><span class="co"># DIAGNOSIS DEL MODELO GAMMA</span></span>
<span id="cb4-103"><a href="#cb4-103" tabindex="-1"></a><span class="fu">library</span>(boot)</span>
<span id="cb4-104"><a href="#cb4-104" tabindex="-1"></a>fit.gama.diag <span class="ot">&lt;-</span> <span class="fu">glm.diag</span>(fit1.gamma)</span>
<span id="cb4-105"><a href="#cb4-105" tabindex="-1"></a><span class="fu">glm.diag.plots</span>(fit1.gamma, fit.gama.diag)</span>
<span id="cb4-106"><a href="#cb4-106" tabindex="-1"></a></span>
<span id="cb4-107"><a href="#cb4-107" tabindex="-1"></a>(SSE.gama.log <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">resid</span>(fit.step.gama))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb4-108"><a href="#cb4-108" tabindex="-1"></a><span class="co"># -------------------------------------------------------</span></span>
<span id="cb4-109"><a href="#cb4-109" tabindex="-1"></a></span>
<span id="cb4-110"><a href="#cb4-110" tabindex="-1"></a></span>
<span id="cb4-111"><a href="#cb4-111" tabindex="-1"></a></span>
<span id="cb4-112"><a href="#cb4-112" tabindex="-1"></a></span>
<span id="cb4-113"><a href="#cb4-113" tabindex="-1"></a></span>
<span id="cb4-114"><a href="#cb4-114" tabindex="-1"></a><span class="do">## resultados --------------------------------------------</span></span>
<span id="cb4-115"><a href="#cb4-115" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary.glm</span>(fit1.gamma)))</span>
<span id="cb4-116"><a href="#cb4-116" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(marco)</span>
<span id="cb4-117"><a href="#cb4-117" tabindex="-1"></a>bethas <span class="ot">&lt;-</span> marco<span class="sc">$</span>Estimate</span>
<span id="cb4-118"><a href="#cb4-118" tabindex="-1"></a>error <span class="ot">&lt;-</span> marco<span class="sc">$</span>Std..Error</span>
<span id="cb4-119"><a href="#cb4-119" tabindex="-1"></a>zetas <span class="ot">&lt;-</span> marco<span class="sc">$</span>t.value</span>
<span id="cb4-120"><a href="#cb4-120" tabindex="-1"></a>valorp <span class="ot">&lt;-</span> marco<span class="sc">$</span>Pr...t..</span>
<span id="cb4-121"><a href="#cb4-121" tabindex="-1"></a>RR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">3</span>)</span>
<span id="cb4-122"><a href="#cb4-122" tabindex="-1"></a>AIC <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">3</span>)</span>
<span id="cb4-123"><a href="#cb4-123" tabindex="-1"></a>BIC <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">3</span>)</span>
<span id="cb4-124"><a href="#cb4-124" tabindex="-1"></a>(res_fit1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(labels,<span class="at">beta=</span><span class="fu">round</span>(bethas,<span class="dv">4</span>), <span class="at">expBetas=</span>RR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,AIC,<span class="st">&quot;-&quot;</span>,BIC,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalor=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span></code></pre></div>
</div>
<div id="modelos-lineales-generalizados-mixtos-glmm" class="section level2">
<h2>Modelos Lineales Generalizados Mixtos GLMM</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">library</span>(NHSRdatasets)</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;LOS_model&quot;</span>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(LOS_model)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="fu">head</span>(dataset,<span class="dv">20</span>)</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>dataset<span class="sc">$</span>Death <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>Death, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>dataset<span class="sc">$</span>Age_st <span class="ot">&lt;-</span> <span class="fu">scale</span>(dataset<span class="sc">$</span>Age)</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>fit0.glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(LOS <span class="sc">~</span></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>                     </span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>                     Age_st <span class="sc">+</span></span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>                     Death</span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a>                   </span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>                   , <span class="at">family=</span>poisson, <span class="at">data=</span>dataset)</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a></span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a><span class="fu">summary</span>(fit0.glm)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>fit1.glmm <span class="ot">&lt;-</span> <span class="fu">glmer</span>(LOS <span class="sc">~</span></span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a>                        </span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>                        Age_st <span class="sc">+</span></span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>                        Death <span class="sc">+</span></span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>                        (<span class="dv">1</span><span class="sc">|</span>Organisation)</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a>                      </span>
<span id="cb5-37"><a href="#cb5-37" tabindex="-1"></a>                        , <span class="at">family=</span>poisson, <span class="at">data=</span>dataset)</span>
<span id="cb5-38"><a href="#cb5-38" tabindex="-1"></a></span>
<span id="cb5-39"><a href="#cb5-39" tabindex="-1"></a></span>
<span id="cb5-40"><a href="#cb5-40" tabindex="-1"></a><span class="fu">summary</span>(fit1.glmm)</span>
<span id="cb5-41"><a href="#cb5-41" tabindex="-1"></a></span>
<span id="cb5-42"><a href="#cb5-42" tabindex="-1"></a></span>
<span id="cb5-43"><a href="#cb5-43" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" tabindex="-1"></a></span>
<span id="cb5-45"><a href="#cb5-45" tabindex="-1"></a><span class="fu">AIC</span>(fit0.glm,fit1.glmm)</span>
<span id="cb5-46"><a href="#cb5-46" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" tabindex="-1"></a></span>
<span id="cb5-48"><a href="#cb5-48" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" tabindex="-1"></a></span>
<span id="cb5-50"><a href="#cb5-50" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(fit1.glmm),<span class="fu">resid</span>(fit1.glmm),<span class="at">xlab=</span><span class="st">&quot;Fitted values&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb5-51"><a href="#cb5-51" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span></code></pre></div>
</div>
<div id="modelos-lineales-generalizados-mixtos-medidas-repetidas-glmm" class="section level2">
<h2>## Modelos Lineales Generalizados Mixtos medidas repetidas GLMM</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;licorice_gargle&quot;</span>)</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="fu">names</span>(licorice_gargle)</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> licorice_gargle[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">17</span>,<span class="dv">19</span>)]</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="fu">head</span>(dataset0)</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_gender , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>))</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_asa <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_asa , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;normal healthy&quot;</span>,<span class="st">&quot;mild systemic disease&quot;</span>,<span class="st">&quot;severe systemic disease&quot;</span>))</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_smoking <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_smoking , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Current&quot;</span>,<span class="st">&quot;Past&quot;</span>,<span class="st">&quot;Never&quot;</span>))</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co">#dataset0$preOp_pain &lt;- factor(dataset0$preOp_pain , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>dataset0<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>treat , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Sugar 5g&quot;</span>,<span class="st">&quot;Licorice 0.5g&quot;</span>))</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a></span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_30min[dataset0<span class="sc">$</span>pacu30min_cough <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_30min[dataset0<span class="sc">$</span>pacu30min_cough <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_90min[dataset0<span class="sc">$</span>pacu90min_cough <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_90min[dataset0<span class="sc">$</span>pacu90min_cough <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_4h[dataset0<span class="sc">$</span>postOp4hour_cough  <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_4h[dataset0<span class="sc">$</span>postOp4hour_cough  <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_1mor[dataset0<span class="sc">$</span>pod1am_cough  <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_1mor[dataset0<span class="sc">$</span>pod1am_cough  <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a><span class="co"># dataset0$cough_30min &lt;- factor(dataset0$cough_30min , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co"># dataset0$cough_90min &lt;- factor(dataset0$cough_90min , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a><span class="co"># dataset0$cough_4h &lt;- factor(dataset0$cough_4h , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a><span class="co"># dataset0$cough_1mor &lt;- factor(dataset0$cough_1mor , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a></span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="fu">head</span>(dataset)[,<span class="dv">4</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a></span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a></span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>dataset<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dataset))</span>
<span id="cb6-43"><a href="#cb6-43" tabindex="-1"></a></span>
<span id="cb6-44"><a href="#cb6-44" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb6-46"><a href="#cb6-46" tabindex="-1"></a></span>
<span id="cb6-47"><a href="#cb6-47" tabindex="-1"></a><span class="co"># ID variables - all the variables to keep but not split apart on</span></span>
<span id="cb6-48"><a href="#cb6-48" tabindex="-1"></a>idvars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>,<span class="st">&quot;preOp_gender&quot;</span>,<span class="st">&quot;preOp_asa&quot;</span>,<span class="st">&quot;preOp_calcBMI&quot;</span>,<span class="st">&quot;preOp_age&quot;</span>,<span class="st">&quot;preOp_smoking&quot;</span>,<span class="st">&quot;treat&quot;</span>)</span>
<span id="cb6-49"><a href="#cb6-49" tabindex="-1"></a></span>
<span id="cb6-50"><a href="#cb6-50" tabindex="-1"></a><span class="co"># The source columns</span></span>
<span id="cb6-51"><a href="#cb6-51" tabindex="-1"></a>measurevars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cough_30min&quot;</span>, <span class="st">&quot;cough_90min&quot;</span>, <span class="st">&quot;cough_4h&quot;</span>,<span class="st">&quot;cough_1mor&quot;</span> )</span>
<span id="cb6-52"><a href="#cb6-52" tabindex="-1"></a></span>
<span id="cb6-53"><a href="#cb6-53" tabindex="-1"></a>dataset.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(dataset, <span class="at">id.vars=</span>idvars, <span class="at">measure.vars=</span>measurevars,</span>
<span id="cb6-54"><a href="#cb6-54" tabindex="-1"></a></span>
<span id="cb6-55"><a href="#cb6-55" tabindex="-1"></a>                  <span class="at">variable.name=</span><span class="st">&quot;time&quot;</span>, <span class="at">value.name=</span><span class="st">&quot;cough&quot;</span>)</span>
<span id="cb6-56"><a href="#cb6-56" tabindex="-1"></a></span>
<span id="cb6-57"><a href="#cb6-57" tabindex="-1"></a></span>
<span id="cb6-58"><a href="#cb6-58" tabindex="-1"></a></span>
<span id="cb6-59"><a href="#cb6-59" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb6-60"><a href="#cb6-60" tabindex="-1"></a><span class="fu">dim</span>(dataset.long)</span>
<span id="cb6-61"><a href="#cb6-61" tabindex="-1"></a></span>
<span id="cb6-62"><a href="#cb6-62" tabindex="-1"></a></span>
<span id="cb6-63"><a href="#cb6-63" tabindex="-1"></a>dataset.long <span class="ot">&lt;-</span> dataset.long[<span class="fu">order</span>(dataset.long<span class="sc">$</span>ID),]</span>
<span id="cb6-64"><a href="#cb6-64" tabindex="-1"></a><span class="fu">row.names</span>(dataset.long) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-65"><a href="#cb6-65" tabindex="-1"></a></span>
<span id="cb6-66"><a href="#cb6-66" tabindex="-1"></a>dataset.long[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb6-67"><a href="#cb6-67" tabindex="-1"></a></span>
<span id="cb6-68"><a href="#cb6-68" tabindex="-1"></a></span>
<span id="cb6-69"><a href="#cb6-69" tabindex="-1"></a></span>
<span id="cb6-70"><a href="#cb6-70" tabindex="-1"></a></span>
<span id="cb6-71"><a href="#cb6-71" tabindex="-1"></a><span class="fu">library</span>(lme4)</span>
<span id="cb6-72"><a href="#cb6-72" tabindex="-1"></a></span>
<span id="cb6-73"><a href="#cb6-73" tabindex="-1"></a></span>
<span id="cb6-74"><a href="#cb6-74" tabindex="-1"></a></span>
<span id="cb6-75"><a href="#cb6-75" tabindex="-1"></a>fit0.glm <span class="ot">&lt;-</span> <span class="fu">glm</span>(cough <span class="sc">~</span></span>
<span id="cb6-76"><a href="#cb6-76" tabindex="-1"></a>                  </span>
<span id="cb6-77"><a href="#cb6-77" tabindex="-1"></a>                  preOp_gender <span class="sc">+</span></span>
<span id="cb6-78"><a href="#cb6-78" tabindex="-1"></a>                  preOp_asa <span class="sc">+</span></span>
<span id="cb6-79"><a href="#cb6-79" tabindex="-1"></a>                  preOp_calcBMI <span class="sc">+</span></span>
<span id="cb6-80"><a href="#cb6-80" tabindex="-1"></a>                  preOp_age <span class="sc">+</span></span>
<span id="cb6-81"><a href="#cb6-81" tabindex="-1"></a>                  preOp_smoking <span class="sc">+</span></span>
<span id="cb6-82"><a href="#cb6-82" tabindex="-1"></a>                  treat <span class="sc">+</span></span>
<span id="cb6-83"><a href="#cb6-83" tabindex="-1"></a>                  time <span class="sc">+</span></span>
<span id="cb6-84"><a href="#cb6-84" tabindex="-1"></a>                  treat<span class="sc">*</span>time</span>
<span id="cb6-85"><a href="#cb6-85" tabindex="-1"></a>                </span>
<span id="cb6-86"><a href="#cb6-86" tabindex="-1"></a>                , <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>dataset.long)</span>
<span id="cb6-87"><a href="#cb6-87" tabindex="-1"></a></span>
<span id="cb6-88"><a href="#cb6-88" tabindex="-1"></a></span>
<span id="cb6-89"><a href="#cb6-89" tabindex="-1"></a><span class="fu">summary</span>(fit0.glm)</span>
<span id="cb6-90"><a href="#cb6-90" tabindex="-1"></a></span>
<span id="cb6-91"><a href="#cb6-91" tabindex="-1"></a></span>
<span id="cb6-92"><a href="#cb6-92" tabindex="-1"></a></span>
<span id="cb6-93"><a href="#cb6-93" tabindex="-1"></a>fit1.glmm <span class="ot">&lt;-</span> <span class="fu">glmer</span>(cough <span class="sc">~</span></span>
<span id="cb6-94"><a href="#cb6-94" tabindex="-1"></a>                     </span>
<span id="cb6-95"><a href="#cb6-95" tabindex="-1"></a>                     preOp_gender <span class="sc">+</span></span>
<span id="cb6-96"><a href="#cb6-96" tabindex="-1"></a>                     preOp_asa <span class="sc">+</span></span>
<span id="cb6-97"><a href="#cb6-97" tabindex="-1"></a>                     preOp_calcBMI <span class="sc">+</span></span>
<span id="cb6-98"><a href="#cb6-98" tabindex="-1"></a>                     preOp_age <span class="sc">+</span></span>
<span id="cb6-99"><a href="#cb6-99" tabindex="-1"></a>                     preOp_smoking <span class="sc">+</span></span>
<span id="cb6-100"><a href="#cb6-100" tabindex="-1"></a>                     treat <span class="sc">+</span></span>
<span id="cb6-101"><a href="#cb6-101" tabindex="-1"></a>                     time <span class="sc">+</span></span>
<span id="cb6-102"><a href="#cb6-102" tabindex="-1"></a>                     treat<span class="sc">*</span>time <span class="sc">+</span></span>
<span id="cb6-103"><a href="#cb6-103" tabindex="-1"></a>                     (<span class="dv">1</span><span class="sc">|</span>ID)</span>
<span id="cb6-104"><a href="#cb6-104" tabindex="-1"></a>                   </span>
<span id="cb6-105"><a href="#cb6-105" tabindex="-1"></a>                   , <span class="at">family=</span>binomial, <span class="at">data=</span>dataset.long, </span>
<span id="cb6-106"><a href="#cb6-106" tabindex="-1"></a>                     <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">&quot;bobyqa&quot;</span>, <span class="at">optCtrl =</span> <span class="fu">list</span>(<span class="at">maxfun =</span> <span class="dv">100000</span>)))</span>
<span id="cb6-107"><a href="#cb6-107" tabindex="-1"></a></span>
<span id="cb6-108"><a href="#cb6-108" tabindex="-1"></a><span class="fu">summary</span>(fit1.glmm)</span>
<span id="cb6-109"><a href="#cb6-109" tabindex="-1"></a></span>
<span id="cb6-110"><a href="#cb6-110" tabindex="-1"></a></span>
<span id="cb6-111"><a href="#cb6-111" tabindex="-1"></a></span>
<span id="cb6-112"><a href="#cb6-112" tabindex="-1"></a></span>
<span id="cb6-113"><a href="#cb6-113" tabindex="-1"></a><span class="fu">AIC</span>(fit0.glm,fit1.glmm)</span>
<span id="cb6-114"><a href="#cb6-114" tabindex="-1"></a></span>
<span id="cb6-115"><a href="#cb6-115" tabindex="-1"></a><span class="fu">drop1</span>(fit1.glmm,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb6-116"><a href="#cb6-116" tabindex="-1"></a></span>
<span id="cb6-117"><a href="#cb6-117" tabindex="-1"></a></span>
<span id="cb6-118"><a href="#cb6-118" tabindex="-1"></a></span>
<span id="cb6-119"><a href="#cb6-119" tabindex="-1"></a>fit2.glmm <span class="ot">&lt;-</span> <span class="fu">glmer</span>(cough <span class="sc">~</span></span>
<span id="cb6-120"><a href="#cb6-120" tabindex="-1"></a>                     </span>
<span id="cb6-121"><a href="#cb6-121" tabindex="-1"></a>                     <span class="co">#preOp_gender +</span></span>
<span id="cb6-122"><a href="#cb6-122" tabindex="-1"></a>                     <span class="co">#preOp_asa +</span></span>
<span id="cb6-123"><a href="#cb6-123" tabindex="-1"></a>                     <span class="co">#preOp_calcBMI +</span></span>
<span id="cb6-124"><a href="#cb6-124" tabindex="-1"></a>                     preOp_age <span class="sc">+</span></span>
<span id="cb6-125"><a href="#cb6-125" tabindex="-1"></a>                     <span class="co">#preOp_smoking +</span></span>
<span id="cb6-126"><a href="#cb6-126" tabindex="-1"></a>                     treat <span class="sc">+</span></span>
<span id="cb6-127"><a href="#cb6-127" tabindex="-1"></a>                     time <span class="sc">+</span></span>
<span id="cb6-128"><a href="#cb6-128" tabindex="-1"></a>                     <span class="co">#treat*time +</span></span>
<span id="cb6-129"><a href="#cb6-129" tabindex="-1"></a>                     (<span class="dv">1</span><span class="sc">|</span>ID)</span>
<span id="cb6-130"><a href="#cb6-130" tabindex="-1"></a>                   </span>
<span id="cb6-131"><a href="#cb6-131" tabindex="-1"></a>                   , <span class="at">family=</span>binomial, <span class="at">data=</span>dataset.long, </span>
<span id="cb6-132"><a href="#cb6-132" tabindex="-1"></a>                   <span class="fu">glmerControl</span>(<span class="at">optimizer =</span> <span class="st">&quot;bobyqa&quot;</span>, <span class="at">optCtrl =</span> <span class="fu">list</span>(<span class="at">maxfun =</span> <span class="dv">100000</span>)), <span class="at">nAGQ=</span><span class="dv">5</span>)</span>
<span id="cb6-133"><a href="#cb6-133" tabindex="-1"></a></span>
<span id="cb6-134"><a href="#cb6-134" tabindex="-1"></a></span>
<span id="cb6-135"><a href="#cb6-135" tabindex="-1"></a><span class="fu">drop1</span>(fit2.glmm,<span class="at">test=</span><span class="st">&quot;Chisq&quot;</span>)</span>
<span id="cb6-136"><a href="#cb6-136" tabindex="-1"></a></span>
<span id="cb6-137"><a href="#cb6-137" tabindex="-1"></a><span class="fu">summary</span>(fit2.glmm)</span>
<span id="cb6-138"><a href="#cb6-138" tabindex="-1"></a></span>
<span id="cb6-139"><a href="#cb6-139" tabindex="-1"></a></span>
<span id="cb6-140"><a href="#cb6-140" tabindex="-1"></a><span class="do">## resultados --------------------------------------------</span></span>
<span id="cb6-141"><a href="#cb6-141" tabindex="-1"></a>marco <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="fu">coefficients</span>(<span class="fu">summary</span>(fit2.glmm)))</span>
<span id="cb6-142"><a href="#cb6-142" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">rownames</span>(marco)</span>
<span id="cb6-143"><a href="#cb6-143" tabindex="-1"></a>bethas <span class="ot">&lt;-</span> marco<span class="sc">$</span>Estimate</span>
<span id="cb6-144"><a href="#cb6-144" tabindex="-1"></a>error <span class="ot">&lt;-</span> marco<span class="sc">$</span>Std..Error</span>
<span id="cb6-145"><a href="#cb6-145" tabindex="-1"></a>valorp <span class="ot">&lt;-</span> marco[,<span class="dv">4</span>]</span>
<span id="cb6-146"><a href="#cb6-146" tabindex="-1"></a></span>
<span id="cb6-147"><a href="#cb6-147" tabindex="-1"></a>OR <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas),<span class="dv">3</span>)</span>
<span id="cb6-148"><a href="#cb6-148" tabindex="-1"></a>AIC <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">-1.96</span><span class="sc">*</span>error),<span class="dv">3</span>)</span>
<span id="cb6-149"><a href="#cb6-149" tabindex="-1"></a>BIC <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">exp</span>(bethas<span class="fl">+1.96</span><span class="sc">*</span>error),<span class="dv">3</span>)</span>
<span id="cb6-150"><a href="#cb6-150" tabindex="-1"></a>(res_fit1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(labels,<span class="at">beta=</span><span class="fu">round</span>(bethas,<span class="dv">4</span>), <span class="at">OR=</span>OR,<span class="at">IC=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,AIC,<span class="st">&quot;-&quot;</span>,BIC,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>), <span class="at">pvalor=</span><span class="fu">round</span>(valorp,<span class="dv">3</span>)))</span>
<span id="cb6-151"><a href="#cb6-151" tabindex="-1"></a></span>
<span id="cb6-152"><a href="#cb6-152" tabindex="-1"></a></span>
<span id="cb6-153"><a href="#cb6-153" tabindex="-1"></a><span class="co"># BONDAD DE AJUSTE---------------------------------------------</span></span>
<span id="cb6-154"><a href="#cb6-154" tabindex="-1"></a></span>
<span id="cb6-155"><a href="#cb6-155" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">fitted</span>(fit2.glmm),<span class="fu">resid</span>(fit2.glmm),<span class="at">xlab=</span><span class="st">&quot;Fitted values&quot;</span>,<span class="at">ylab=</span><span class="st">&quot;Residuals&quot;</span>)</span>
<span id="cb6-156"><a href="#cb6-156" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-157"><a href="#cb6-157" tabindex="-1"></a></span>
<span id="cb6-158"><a href="#cb6-158" tabindex="-1"></a></span>
<span id="cb6-159"><a href="#cb6-159" tabindex="-1"></a><span class="co"># otra forma---</span></span>
<span id="cb6-160"><a href="#cb6-160" tabindex="-1"></a>my.res <span class="ot">&lt;-</span> <span class="fu">residuals</span>(fit2.glmm, <span class="at">type=</span><span class="st">&quot;pearson&quot;</span>)</span>
<span id="cb6-161"><a href="#cb6-161" tabindex="-1"></a>my.fit <span class="ot">&lt;-</span> <span class="fu">fitted</span>(fit2.glmm)</span>
<span id="cb6-162"><a href="#cb6-162" tabindex="-1"></a></span>
<span id="cb6-163"><a href="#cb6-163" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>))</span>
<span id="cb6-164"><a href="#cb6-164" tabindex="-1"></a><span class="fu">plot</span>(my.res <span class="sc">~</span> my.fit)</span>
<span id="cb6-165"><a href="#cb6-165" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-166"><a href="#cb6-166" tabindex="-1"></a></span>
<span id="cb6-167"><a href="#cb6-167" tabindex="-1"></a><span class="fu">plot</span>(fit2.glmm<span class="sc">@</span>frame<span class="sc">$</span>preOp_age, my.res)</span>
<span id="cb6-168"><a href="#cb6-168" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-169"><a href="#cb6-169" tabindex="-1"></a></span>
<span id="cb6-170"><a href="#cb6-170" tabindex="-1"></a></span>
<span id="cb6-171"><a href="#cb6-171" tabindex="-1"></a><span class="fu">plot</span>(fit2.glmm<span class="sc">@</span>frame<span class="sc">$</span>treat, my.res)</span>
<span id="cb6-172"><a href="#cb6-172" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-173"><a href="#cb6-173" tabindex="-1"></a></span>
<span id="cb6-174"><a href="#cb6-174" tabindex="-1"></a></span>
<span id="cb6-175"><a href="#cb6-175" tabindex="-1"></a><span class="fu">plot</span>(fit2.glmm<span class="sc">@</span>frame<span class="sc">$</span>time, my.res)</span>
<span id="cb6-176"><a href="#cb6-176" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-177"><a href="#cb6-177" tabindex="-1"></a></span>
<span id="cb6-178"><a href="#cb6-178" tabindex="-1"></a></span>
<span id="cb6-179"><a href="#cb6-179" tabindex="-1"></a><span class="fu">plot</span>(fit2.glmm<span class="sc">@</span>frame<span class="sc">$</span>ID, my.res)</span>
<span id="cb6-180"><a href="#cb6-180" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="dv">0</span>, <span class="at">lty=</span><span class="dv">3</span>)</span>
<span id="cb6-181"><a href="#cb6-181" tabindex="-1"></a><span class="co"># ---------------------------------------------------------------</span></span>
<span id="cb6-182"><a href="#cb6-182" tabindex="-1"></a></span>
<span id="cb6-183"><a href="#cb6-183" tabindex="-1"></a></span>
<span id="cb6-184"><a href="#cb6-184" tabindex="-1"></a></span>
<span id="cb6-185"><a href="#cb6-185" tabindex="-1"></a></span>
<span id="cb6-186"><a href="#cb6-186" tabindex="-1"></a><span class="fu">test.cat</span>(dataset.long<span class="sc">$</span>treat,dataset.long<span class="sc">$</span>cough )</span>
<span id="cb6-187"><a href="#cb6-187" tabindex="-1"></a></span>
<span id="cb6-188"><a href="#cb6-188" tabindex="-1"></a></span>
<span id="cb6-189"><a href="#cb6-189" tabindex="-1"></a>var.time <span class="ot">&lt;-</span> <span class="fu">levels</span>(dataset.long<span class="sc">$</span>time)</span>
<span id="cb6-190"><a href="#cb6-190" tabindex="-1"></a>  xx <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb6-191"><a href="#cb6-191" tabindex="-1"></a>  <span class="cf">for</span>(j <span class="cf">in</span> var.time){</span>
<span id="cb6-192"><a href="#cb6-192" tabindex="-1"></a>    </span>
<span id="cb6-193"><a href="#cb6-193" tabindex="-1"></a>    sub <span class="ot">&lt;-</span> dataset.long[dataset.long<span class="sc">$</span>time <span class="sc">==</span> j,] </span>
<span id="cb6-194"><a href="#cb6-194" tabindex="-1"></a>    </span>
<span id="cb6-195"><a href="#cb6-195" tabindex="-1"></a>    xx[[j]] <span class="ot">&lt;-</span> <span class="fu">test.cat</span>(sub<span class="sc">$</span>treat,sub<span class="sc">$</span>cough )</span>
<span id="cb6-196"><a href="#cb6-196" tabindex="-1"></a>    </span>
<span id="cb6-197"><a href="#cb6-197" tabindex="-1"></a>  }</span>
<span id="cb6-198"><a href="#cb6-198" tabindex="-1"></a>  xx</span>
<span id="cb6-199"><a href="#cb6-199" tabindex="-1"></a>  </span>
<span id="cb6-200"><a href="#cb6-200" tabindex="-1"></a>  </span>
<span id="cb6-201"><a href="#cb6-201" tabindex="-1"></a>  <span class="fu">test.cat</span>(dataset.long<span class="sc">$</span>time,dataset.long<span class="sc">$</span>cough )</span>
<span id="cb6-202"><a href="#cb6-202" tabindex="-1"></a>  </span>
<span id="cb6-203"><a href="#cb6-203" tabindex="-1"></a>  </span></code></pre></div>
</div>
<div id="modelos-aditivos-generalizados-gam" class="section level2">
<h2>Modelos Aditivos Generalizados GAM</h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="fu">library</span>(MixAll)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="fu">data</span>(DebTrivedi)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> DebTrivedi</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a></span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> dataset<span class="sc">$</span>age<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a></span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a></span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>fit1.q <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a>                </span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>                hosp <span class="sc">+</span> </span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>                health <span class="sc">+</span> </span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a>                numchron <span class="sc">+</span> </span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>                <span class="co">#adldiff + </span></span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a>                region <span class="sc">+</span> </span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>                <span class="co">#age + </span></span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>                <span class="co">#black + </span></span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>                gender <span class="sc">+</span> </span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>                <span class="co">#married +</span></span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a>                school <span class="sc">+</span> </span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>                <span class="co">#faminc + </span></span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a>                <span class="co">#employed + </span></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>                privins <span class="sc">+</span> </span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>                medicaid</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>              </span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>              ,<span class="at">family=</span><span class="fu">quasi</span>(<span class="at">link=</span><span class="st">&quot;log&quot;</span>,<span class="at">variance=</span><span class="st">&quot;mu&quot;</span>), <span class="at">data=</span>dataset)</span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>fit1.gam <span class="ot">&lt;-</span> <span class="fu">gam</span>(ofp <span class="sc">~</span> </span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>                </span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a>                hosp <span class="sc">+</span> </span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a>                health <span class="sc">+</span> </span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>                numchron <span class="sc">+</span> </span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>                <span class="co">#adldiff + </span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a>                region <span class="sc">+</span> </span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>                <span class="co">#age + </span></span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a>                <span class="co">#black + </span></span>
<span id="cb7-52"><a href="#cb7-52" tabindex="-1"></a>                gender <span class="sc">+</span> </span>
<span id="cb7-53"><a href="#cb7-53" tabindex="-1"></a>                <span class="co">#married +</span></span>
<span id="cb7-54"><a href="#cb7-54" tabindex="-1"></a>                <span class="fu">s</span>(school) <span class="sc">+</span> </span>
<span id="cb7-55"><a href="#cb7-55" tabindex="-1"></a>                <span class="co">#faminc + </span></span>
<span id="cb7-56"><a href="#cb7-56" tabindex="-1"></a>                <span class="co">#employed + </span></span>
<span id="cb7-57"><a href="#cb7-57" tabindex="-1"></a>                privins <span class="sc">+</span> </span>
<span id="cb7-58"><a href="#cb7-58" tabindex="-1"></a>                medicaid</span>
<span id="cb7-59"><a href="#cb7-59" tabindex="-1"></a>              </span>
<span id="cb7-60"><a href="#cb7-60" tabindex="-1"></a>              ,<span class="at">family=</span>poisson, <span class="at">data=</span>dataset)</span>
<span id="cb7-61"><a href="#cb7-61" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" tabindex="-1"></a><span class="fu">anova</span>(fit1.q,fit1.gam, <span class="at">test=</span><span class="st">&quot;F&quot;</span>)</span>
<span id="cb7-64"><a href="#cb7-64" tabindex="-1"></a></span>
<span id="cb7-65"><a href="#cb7-65" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" tabindex="-1"></a><span class="fu">summary</span>(fit1.gam)</span>
<span id="cb7-67"><a href="#cb7-67" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" tabindex="-1"></a><span class="fu">plot.gam</span>(fit1.gam, <span class="at">select =</span> <span class="dv">1</span>,<span class="at">shade =</span> <span class="cn">TRUE</span>, </span>
<span id="cb7-69"><a href="#cb7-69" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;Years of education&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;log-physician visits&quot;</span>)</span></code></pre></div>
</div>
<div id="modelos-aditivos-generalizados-mixtos-gamm" class="section level2">
<h2>Modelos Aditivos Generalizados Mixtos GAMM</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="fu">library</span>(NHSRdatasets)</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;LOS_model&quot;</span>)</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(LOS_model)</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="fu">head</span>(dataset,<span class="dv">20</span>)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>dataset<span class="sc">$</span>Death <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>Death, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>dataset<span class="sc">$</span>Age_st <span class="ot">&lt;-</span> <span class="fu">scale</span>(dataset<span class="sc">$</span>Age)</span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>fit1.gamm <span class="ot">&lt;-</span> <span class="fu">gamm</span>(LOS <span class="sc">~</span></span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>                  </span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a>                  <span class="fu">s</span>(Age_st) <span class="sc">+</span></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>                  Death</span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>                </span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>                , <span class="at">family=</span>poisson, <span class="at">random =</span> <span class="fu">list</span>(<span class="at">Organisation =</span> <span class="sc">~</span> <span class="dv">1</span>), <span class="at">data=</span>dataset)</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a></span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a></span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="fu">summary</span>(fit1.gamm<span class="sc">$</span>gam)</span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a><span class="fu">summary</span>(fit1.gamm<span class="sc">$</span>lme)</span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a> <span class="fu">plot.gam</span>(fit1.gamm<span class="sc">$</span>gam, <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">&quot;Age_st&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;log-physician visits&quot;</span>)</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>          </span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a> </span></code></pre></div>
</div>
<div id="modelos-aditivos-generalizados-mixtos-medidas-repetidas-gamm" class="section level2">
<h2>Modelos Aditivos Generalizados Mixtos Medidas Repetidas GAMM</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="fu">library</span>(medicaldata)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;licorice_gargle&quot;</span>)</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">names</span>(licorice_gargle)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> licorice_gargle[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">12</span>,<span class="dv">13</span>,<span class="dv">15</span>,<span class="dv">17</span>,<span class="dv">19</span>)]</span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="fu">head</span>(dataset0)</span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_gender , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Male&quot;</span>,<span class="st">&quot;Female&quot;</span>))</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_asa <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_asa , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;normal healthy&quot;</span>,<span class="st">&quot;mild systemic disease&quot;</span>,<span class="st">&quot;severe systemic disease&quot;</span>))</span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>dataset0<span class="sc">$</span>preOp_smoking <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>preOp_smoking , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Current&quot;</span>,<span class="st">&quot;Past&quot;</span>,<span class="st">&quot;Never&quot;</span>))</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a><span class="co">#dataset0$preOp_pain &lt;- factor(dataset0$preOp_pain , labels = c(&quot;No&quot;,&quot;Yes&quot;))</span></span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>dataset0<span class="sc">$</span>treat <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset0<span class="sc">$</span>treat , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Sugar 5g&quot;</span>,<span class="st">&quot;Licorice 0.5g&quot;</span>))</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a></span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_30min[dataset0<span class="sc">$</span>pacu30min_cough <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_30min[dataset0<span class="sc">$</span>pacu30min_cough <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_90min[dataset0<span class="sc">$</span>pacu90min_cough <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_90min[dataset0<span class="sc">$</span>pacu90min_cough <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_4h[dataset0<span class="sc">$</span>postOp4hour_cough  <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_4h[dataset0<span class="sc">$</span>postOp4hour_cough  <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_1mor[dataset0<span class="sc">$</span>pod1am_cough  <span class="sc">&gt;</span><span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>dataset0<span class="sc">$</span>cough_1mor[dataset0<span class="sc">$</span>pod1am_cough  <span class="sc">==</span> <span class="dv">0</span> ] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a></span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a></span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">8</span><span class="sc">:</span><span class="dv">11</span>)]</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a></span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a><span class="fu">head</span>(dataset)[,<span class="dv">4</span><span class="sc">:</span><span class="dv">11</span>]</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" tabindex="-1"></a>dataset<span class="sc">$</span>ID <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(dataset))</span>
<span id="cb9-42"><a href="#cb9-42" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" tabindex="-1"></a></span>
<span id="cb9-44"><a href="#cb9-44" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb9-45"><a href="#cb9-45" tabindex="-1"></a></span>
<span id="cb9-46"><a href="#cb9-46" tabindex="-1"></a><span class="co"># ID variables - all the variables to keep but not split apart on</span></span>
<span id="cb9-47"><a href="#cb9-47" tabindex="-1"></a>idvars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>,<span class="st">&quot;preOp_gender&quot;</span>,<span class="st">&quot;preOp_asa&quot;</span>,<span class="st">&quot;preOp_calcBMI&quot;</span>,<span class="st">&quot;preOp_age&quot;</span>,<span class="st">&quot;preOp_smoking&quot;</span>,<span class="st">&quot;treat&quot;</span>)</span>
<span id="cb9-48"><a href="#cb9-48" tabindex="-1"></a></span>
<span id="cb9-49"><a href="#cb9-49" tabindex="-1"></a><span class="co"># The source columns</span></span>
<span id="cb9-50"><a href="#cb9-50" tabindex="-1"></a>measurevars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;cough_30min&quot;</span>, <span class="st">&quot;cough_90min&quot;</span>, <span class="st">&quot;cough_4h&quot;</span>,<span class="st">&quot;cough_1mor&quot;</span> )</span>
<span id="cb9-51"><a href="#cb9-51" tabindex="-1"></a></span>
<span id="cb9-52"><a href="#cb9-52" tabindex="-1"></a>dataset.long <span class="ot">&lt;-</span> <span class="fu">melt</span>(dataset, <span class="at">id.vars=</span>idvars, <span class="at">measure.vars=</span>measurevars,</span>
<span id="cb9-53"><a href="#cb9-53" tabindex="-1"></a>                     </span>
<span id="cb9-54"><a href="#cb9-54" tabindex="-1"></a>                     <span class="at">variable.name=</span><span class="st">&quot;time&quot;</span>, <span class="at">value.name=</span><span class="st">&quot;cough&quot;</span>)</span>
<span id="cb9-55"><a href="#cb9-55" tabindex="-1"></a></span>
<span id="cb9-56"><a href="#cb9-56" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb9-57"><a href="#cb9-57" tabindex="-1"></a><span class="fu">dim</span>(dataset.long)</span>
<span id="cb9-58"><a href="#cb9-58" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" tabindex="-1"></a></span>
<span id="cb9-60"><a href="#cb9-60" tabindex="-1"></a>dataset.long <span class="ot">&lt;-</span> dataset.long[<span class="fu">order</span>(dataset.long<span class="sc">$</span>ID),]</span>
<span id="cb9-61"><a href="#cb9-61" tabindex="-1"></a><span class="fu">row.names</span>(dataset.long) <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb9-62"><a href="#cb9-62" tabindex="-1"></a></span>
<span id="cb9-63"><a href="#cb9-63" tabindex="-1"></a>dataset.long[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span><span class="sc">:</span><span class="dv">9</span>)]</span>
<span id="cb9-64"><a href="#cb9-64" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" tabindex="-1"></a></span>
<span id="cb9-66"><a href="#cb9-66" tabindex="-1"></a><span class="fu">library</span>(mgcv)</span>
<span id="cb9-67"><a href="#cb9-67" tabindex="-1"></a></span>
<span id="cb9-68"><a href="#cb9-68" tabindex="-1"></a>fit2.gamm <span class="ot">&lt;-</span> <span class="fu">gamm</span>(cough <span class="sc">~</span></span>
<span id="cb9-69"><a href="#cb9-69" tabindex="-1"></a>                     </span>
<span id="cb9-70"><a href="#cb9-70" tabindex="-1"></a>                     <span class="co">#preOp_gender +</span></span>
<span id="cb9-71"><a href="#cb9-71" tabindex="-1"></a>                     preOp_asa <span class="sc">+</span></span>
<span id="cb9-72"><a href="#cb9-72" tabindex="-1"></a>                     <span class="co">#preOp_calcBMI +</span></span>
<span id="cb9-73"><a href="#cb9-73" tabindex="-1"></a>                     <span class="fu">s</span>(preOp_age) <span class="sc">+</span></span>
<span id="cb9-74"><a href="#cb9-74" tabindex="-1"></a>                     <span class="co">#preOp_smoking +</span></span>
<span id="cb9-75"><a href="#cb9-75" tabindex="-1"></a>                     treat <span class="sc">+</span></span>
<span id="cb9-76"><a href="#cb9-76" tabindex="-1"></a>                     time </span>
<span id="cb9-77"><a href="#cb9-77" tabindex="-1"></a>                  </span>
<span id="cb9-78"><a href="#cb9-78" tabindex="-1"></a>                   , <span class="at">family=</span>binomial, <span class="at">random =</span> <span class="fu">list</span>(<span class="at">ID =</span> <span class="sc">~</span> <span class="dv">1</span>), <span class="at">data=</span>dataset.long)</span>
<span id="cb9-79"><a href="#cb9-79" tabindex="-1"></a>           </span>
<span id="cb9-80"><a href="#cb9-80" tabindex="-1"></a></span>
<span id="cb9-81"><a href="#cb9-81" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" tabindex="-1"></a><span class="fu">summary</span>(fit2.gamm<span class="sc">$</span>gam)</span>
<span id="cb9-83"><a href="#cb9-83" tabindex="-1"></a></span>
<span id="cb9-84"><a href="#cb9-84" tabindex="-1"></a><span class="fu">summary</span>(fit2.gamm<span class="sc">$</span>lme)</span>
<span id="cb9-85"><a href="#cb9-85" tabindex="-1"></a></span>
<span id="cb9-86"><a href="#cb9-86" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" tabindex="-1"></a><span class="fu">plot.gam</span>(fit2.gamm<span class="sc">$</span>gam, <span class="at">shade =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-88"><a href="#cb9-88" tabindex="-1"></a>         <span class="at">xlab =</span> <span class="st">&quot;Age&quot;</span>, <span class="at">ylab=</span><span class="st">&quot;logit-prob cough&quot;</span>)</span></code></pre></div>
</div>
<div id="regresión-de-cox-con-variable-tiempo-dependiente" class="section level2">
<h2>Regresión de Cox con variable tiempo-dependiente</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cancer&quot;</span>)</span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> colon</span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>dataset<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>))</span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>dataset<span class="sc">$</span>perfor   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>perfor  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb10-10"><a href="#cb10-10" tabindex="-1"></a>dataset<span class="sc">$</span>adhere   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>adhere  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb10-11"><a href="#cb10-11" tabindex="-1"></a>dataset<span class="sc">$</span>differ   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>differ  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;well&quot;</span>,<span class="st">&quot;moderate&quot;</span>,<span class="st">&quot;poor&quot;</span>))</span>
<span id="cb10-12"><a href="#cb10-12" tabindex="-1"></a>dataset<span class="sc">$</span>surg  <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>surg , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Short&quot;</span>,<span class="st">&quot;Long&quot;</span>))</span>
<span id="cb10-13"><a href="#cb10-13" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" tabindex="-1"></a>fit.cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>( <span class="fu">Surv</span>(time, status) <span class="sc">~</span> </span>
<span id="cb10-16"><a href="#cb10-16" tabindex="-1"></a>                       </span>
<span id="cb10-17"><a href="#cb10-17" tabindex="-1"></a>                       rx <span class="sc">+</span></span>
<span id="cb10-18"><a href="#cb10-18" tabindex="-1"></a>                       nodes <span class="sc">+</span></span>
<span id="cb10-19"><a href="#cb10-19" tabindex="-1"></a>                       extent <span class="sc">+</span></span>
<span id="cb10-20"><a href="#cb10-20" tabindex="-1"></a>                       surg <span class="sc">+</span></span>
<span id="cb10-21"><a href="#cb10-21" tabindex="-1"></a>                       obstruct</span>
<span id="cb10-22"><a href="#cb10-22" tabindex="-1"></a>                     </span>
<span id="cb10-23"><a href="#cb10-23" tabindex="-1"></a>                     , <span class="at">data =</span> dataset)</span>
<span id="cb10-24"><a href="#cb10-24" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" tabindex="-1"></a></span>
<span id="cb10-26"><a href="#cb10-26" tabindex="-1"></a>fit.cox.tt <span class="ot">&lt;-</span> <span class="fu">coxph</span>( <span class="fu">Surv</span>(time, status) <span class="sc">~</span> </span>
<span id="cb10-27"><a href="#cb10-27" tabindex="-1"></a>                    </span>
<span id="cb10-28"><a href="#cb10-28" tabindex="-1"></a>                    rx <span class="sc">+</span></span>
<span id="cb10-29"><a href="#cb10-29" tabindex="-1"></a>                    nodes <span class="sc">+</span></span>
<span id="cb10-30"><a href="#cb10-30" tabindex="-1"></a>                    extent <span class="sc">+</span></span>
<span id="cb10-31"><a href="#cb10-31" tabindex="-1"></a>                    surg <span class="sc">+</span></span>
<span id="cb10-32"><a href="#cb10-32" tabindex="-1"></a>                    obstruct <span class="sc">+</span> </span>
<span id="cb10-33"><a href="#cb10-33" tabindex="-1"></a>                    <span class="fu">tt</span>(obstruct) ,</span>
<span id="cb10-34"><a href="#cb10-34" tabindex="-1"></a>                      </span>
<span id="cb10-35"><a href="#cb10-35" tabindex="-1"></a>                     <span class="at">tt=</span><span class="cf">function</span>(x,t,...) x<span class="sc">*</span><span class="fu">log</span>(t)</span>
<span id="cb10-36"><a href="#cb10-36" tabindex="-1"></a>                    </span>
<span id="cb10-37"><a href="#cb10-37" tabindex="-1"></a>                    , <span class="at">data =</span> dataset)</span>
<span id="cb10-38"><a href="#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="#cb10-39" tabindex="-1"></a><span class="fu">summary</span>(fit.cox.tt)</span>
<span id="cb10-40"><a href="#cb10-40" tabindex="-1"></a></span>
<span id="cb10-41"><a href="#cb10-41" tabindex="-1"></a><span class="fu">cox.zph</span>(fit.cox.tt)</span>
<span id="cb10-42"><a href="#cb10-42" tabindex="-1"></a></span>
<span id="cb10-43"><a href="#cb10-43" tabindex="-1"></a></span>
<span id="cb10-44"><a href="#cb10-44" tabindex="-1"></a></span>
<span id="cb10-45"><a href="#cb10-45" tabindex="-1"></a>res.schoenfeld <span class="ot">&lt;-</span> <span class="fu">cox.zph</span>(fit.cox, <span class="at">transform =</span> <span class="cf">function</span>(x) <span class="fu">log</span>(x))</span>
<span id="cb10-46"><a href="#cb10-46" tabindex="-1"></a></span>
<span id="cb10-47"><a href="#cb10-47" tabindex="-1"></a><span class="fu">plot</span>(res.schoenfeld)</span>
<span id="cb10-48"><a href="#cb10-48" tabindex="-1"></a><span class="fu">abline</span>(<span class="fu">coef</span>(fit.cox.tt)[<span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>)],<span class="at">col=</span><span class="st">&quot;red&quot;</span> )</span></code></pre></div>
</div>
<div id="predicciones-de-tiempo-de-supervivencia" class="section level2">
<h2>Predicciones de tiempo de supervivencia</h2>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="fu">data</span>(cancer)</span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>cancer<span class="sc">$</span>status <span class="ot">&lt;-</span> <span class="fu">recode</span>(cancer<span class="sc">$</span>status, <span class="st">&quot;1=0;2=1&quot;</span>)</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a></span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> cancer[<span class="fu">complete.cases</span>(cancer),]</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">survreg</span>( <span class="fu">Surv</span>(time, status) <span class="sc">~</span> </span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>                   </span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>                   age <span class="sc">+</span> </span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>                   sex <span class="sc">+</span> </span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>                   ph.ecog <span class="sc">+</span> </span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>                   ph.karno <span class="sc">+</span> </span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>                   meal.cal <span class="sc">+</span> </span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>                   wt.loss </span>
<span id="cb11-22"><a href="#cb11-22" tabindex="-1"></a>                 </span>
<span id="cb11-23"><a href="#cb11-23" tabindex="-1"></a>                 , <span class="at">data =</span> dataset)</span>
<span id="cb11-24"><a href="#cb11-24" tabindex="-1"></a></span>
<span id="cb11-25"><a href="#cb11-25" tabindex="-1"></a></span>
<span id="cb11-26"><a href="#cb11-26" tabindex="-1"></a></span>
<span id="cb11-27"><a href="#cb11-27" tabindex="-1"></a></span>
<span id="cb11-28"><a href="#cb11-28" tabindex="-1"></a>dataset<span class="sc">$</span>pred.time <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">predict</span>(fit),<span class="dv">0</span>)</span>
<span id="cb11-29"><a href="#cb11-29" tabindex="-1"></a><span class="fu">head</span>(dataset)</span>
<span id="cb11-30"><a href="#cb11-30" tabindex="-1"></a></span>
<span id="cb11-31"><a href="#cb11-31" tabindex="-1"></a></span>
<span id="cb11-32"><a href="#cb11-32" tabindex="-1"></a></span>
<span id="cb11-33"><a href="#cb11-33" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span><span class="dv">50</span>,<span class="at">sex=</span><span class="dv">1</span>,<span class="at">ph.ecog=</span><span class="dv">0</span>,<span class="at">ph.karno=</span><span class="dv">50</span>,<span class="at">meal.cal=</span><span class="dv">1000</span>,<span class="at">wt.loss=</span><span class="dv">10</span>))</span>
<span id="cb11-34"><a href="#cb11-34" tabindex="-1"></a></span>
<span id="cb11-35"><a href="#cb11-35" tabindex="-1"></a></span>
<span id="cb11-36"><a href="#cb11-36" tabindex="-1"></a><span class="fu">predict</span>(fit, <span class="at">newdata =</span> <span class="fu">list</span>(<span class="at">age=</span><span class="dv">70</span>,<span class="at">sex=</span><span class="dv">1</span>,<span class="at">ph.ecog=</span><span class="dv">4</span>,<span class="at">ph.karno=</span><span class="dv">10</span>,<span class="at">meal.cal=</span><span class="dv">600</span>,<span class="at">wt.loss=</span><span class="dv">20</span>))</span></code></pre></div>
</div>
<div id="regresión-cox-aalen" class="section level2">
<h2>Regresión Cox-Aalen</h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;cancer&quot;</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> colon</span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>dataset<span class="sc">$</span>sex <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>sex, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>,<span class="st">&quot;Male&quot;</span>))</span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>dataset<span class="sc">$</span>obstruct  <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>obstruct , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>dataset<span class="sc">$</span>perfor   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>perfor  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>dataset<span class="sc">$</span>adhere   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>adhere  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;No&quot;</span>,<span class="st">&quot;Yes&quot;</span>))</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>dataset<span class="sc">$</span>differ   <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>differ  , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;well&quot;</span>,<span class="st">&quot;moderate&quot;</span>,<span class="st">&quot;poor&quot;</span>))</span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>dataset<span class="sc">$</span>surg  <span class="ot">&lt;-</span> <span class="fu">factor</span>(dataset<span class="sc">$</span>surg , <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Short&quot;</span>,<span class="st">&quot;Long&quot;</span>))</span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>fit.cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>( <span class="fu">Surv</span>(time, status) <span class="sc">~</span> </span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>                    </span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>                    rx <span class="sc">+</span></span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>                    obstruct <span class="sc">+</span></span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>                    nodes <span class="sc">+</span></span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>                    extent <span class="sc">+</span></span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>                    surg </span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>                    </span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>                  , <span class="at">data =</span> dataset)</span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a><span class="fu">summary</span>(fit.cox)</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a><span class="fu">cox.zph</span>(fit.cox)</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a></span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a>km <span class="ot">&lt;-</span> <span class="fu">survfit</span>(<span class="fu">Surv</span>(dataset<span class="sc">$</span>time,dataset<span class="sc">$</span>status) <span class="sc">~</span> dataset<span class="sc">$</span>obstruct)</span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a></span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="fu">plot</span>(km,<span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">mark.time =</span> <span class="cn">FALSE</span>, <span class="at">ylab =</span> <span class="st">&quot;Survival Probability&quot;</span>,</span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">&quot;Time (days)&quot;</span>, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">main=</span><span class="st">&quot;Kaplan-Meier&quot;</span>)</span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a><span class="fu">legend</span>( <span class="st">&quot;bottomleft&quot;</span>, <span class="at">legend =</span> <span class="fu">levels</span>(dataset<span class="sc">$</span>obstruct), <span class="at">lty =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">2</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), </span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>),<span class="at">cex=</span><span class="dv">1</span>, <span class="at">title =</span> <span class="st">&quot;Obstruct&quot;</span>, <span class="at">bty =</span> <span class="st">&quot;n&quot;</span>, <span class="at">y.intersp=</span><span class="dv">1</span>)</span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a></span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a><span class="fu">library</span>(timereg)</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>fit.coxalen <span class="ot">&lt;-</span> <span class="fu">cox.aalen</span>( <span class="fu">Surv</span>(time, status)<span class="sc">~</span> </span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>                             </span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>                            <span class="fu">prop</span>(rx) <span class="sc">+</span></span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a>                            obstruct <span class="sc">+</span></span>
<span id="cb12-50"><a href="#cb12-50" tabindex="-1"></a>                            <span class="fu">prop</span>(nodes) <span class="sc">+</span></span>
<span id="cb12-51"><a href="#cb12-51" tabindex="-1"></a>                            <span class="fu">prop</span>(extent) <span class="sc">+</span></span>
<span id="cb12-52"><a href="#cb12-52" tabindex="-1"></a>                            <span class="fu">prop</span>(surg) </span>
<span id="cb12-53"><a href="#cb12-53" tabindex="-1"></a>                           </span>
<span id="cb12-54"><a href="#cb12-54" tabindex="-1"></a>                           , <span class="at">data=</span>dataset )</span>
<span id="cb12-55"><a href="#cb12-55" tabindex="-1"></a></span>
<span id="cb12-56"><a href="#cb12-56" tabindex="-1"></a></span>
<span id="cb12-57"><a href="#cb12-57" tabindex="-1"></a><span class="fu">summary</span>(fit.coxalen)</span>
<span id="cb12-58"><a href="#cb12-58" tabindex="-1"></a></span>
<span id="cb12-59"><a href="#cb12-59" tabindex="-1"></a></span>
<span id="cb12-60"><a href="#cb12-60" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" tabindex="-1"></a><span class="co"># graficos para hipotesis de proporcionalidad: la linea debe estar dentro de las simulaciones</span></span>
<span id="cb12-62"><a href="#cb12-62" tabindex="-1"></a></span>
<span id="cb12-63"><a href="#cb12-63" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>))</span>
<span id="cb12-64"><a href="#cb12-64" tabindex="-1"></a><span class="fu">plot</span>(fit.coxalen, <span class="at">score=</span>T, <span class="at">cex.main=</span><span class="fl">0.8</span>)</span>
<span id="cb12-65"><a href="#cb12-65" tabindex="-1"></a></span>
<span id="cb12-66"><a href="#cb12-66" tabindex="-1"></a></span>
<span id="cb12-67"><a href="#cb12-67" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" tabindex="-1"></a></span>
<span id="cb12-69"><a href="#cb12-69" tabindex="-1"></a><span class="co"># graficos de las variables que dependen del tiempo</span></span>
<span id="cb12-70"><a href="#cb12-70" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" tabindex="-1"></a><span class="fu">plot</span>(fit.coxalen, <span class="at">conf.band=</span>T, <span class="at">col=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>), <span class="at">main=</span><span class="st">&quot;obstruct&quot;</span>, <span class="at">cex.main=</span><span class="fl">0.8</span>)</span>
<span id="cb12-72"><a href="#cb12-72" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">700</span>, <span class="at">lty=</span><span class="dv">2</span>)</span>
<span id="cb12-73"><a href="#cb12-73" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v=</span><span class="dv">1150</span>, <span class="at">lty=</span><span class="dv">2</span>)</span></code></pre></div>
</div>
<div id="validación-de-modelos" class="section level2">
<h2>Validación de modelos</h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="do">## ----------------------------- SPLIT SAMPLE-----------------------------</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="fu">library</span>(MixAll)</span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="fu">data</span>(DebTrivedi)</span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>dataset0 <span class="ot">&lt;-</span> DebTrivedi</span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a></span>
<span id="cb13-12"><a href="#cb13-12" tabindex="-1"></a><span class="fu">names</span>(dataset0)</span>
<span id="cb13-13"><a href="#cb13-13" tabindex="-1"></a></span>
<span id="cb13-14"><a href="#cb13-14" tabindex="-1"></a></span>
<span id="cb13-15"><a href="#cb13-15" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> dataset0[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)]</span>
<span id="cb13-16"><a href="#cb13-16" tabindex="-1"></a><span class="fu">names</span>(dataset)</span>
<span id="cb13-17"><a href="#cb13-17" tabindex="-1"></a></span>
<span id="cb13-18"><a href="#cb13-18" tabindex="-1"></a>dataset<span class="sc">$</span>age <span class="ot">&lt;-</span> dataset<span class="sc">$</span>age<span class="sc">*</span><span class="dv">10</span></span>
<span id="cb13-19"><a href="#cb13-19" tabindex="-1"></a></span>
<span id="cb13-20"><a href="#cb13-20" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb13-21"><a href="#cb13-21" tabindex="-1"></a></span>
<span id="cb13-22"><a href="#cb13-22" tabindex="-1"></a></span>
<span id="cb13-23"><a href="#cb13-23" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1111</span>)</span>
<span id="cb13-24"><a href="#cb13-24" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" tabindex="-1"></a>n.all <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataset)</span>
<span id="cb13-26"><a href="#cb13-26" tabindex="-1"></a></span>
<span id="cb13-27"><a href="#cb13-27" tabindex="-1"></a>train.ind <span class="ot">=</span> <span class="fu">sample</span>( <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="at">size =</span> n.all, <span class="at">replace=</span>T, <span class="at">prob=</span><span class="fu">c</span>(<span class="fl">0.3</span>,<span class="fl">0.7</span>) )</span>
<span id="cb13-28"><a href="#cb13-28" tabindex="-1"></a><span class="fu">table</span>(train.ind)</span>
<span id="cb13-29"><a href="#cb13-29" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" tabindex="-1"></a>xx.train <span class="ot">=</span> dataset[ train.ind <span class="sc">==</span><span class="dv">1</span>, ]</span>
<span id="cb13-32"><a href="#cb13-32" tabindex="-1"></a>xx.test  <span class="ot">=</span> dataset[ train.ind <span class="sc">==</span><span class="dv">0</span>, ]</span>
<span id="cb13-33"><a href="#cb13-33" tabindex="-1"></a></span>
<span id="cb13-34"><a href="#cb13-34" tabindex="-1"></a></span>
<span id="cb13-35"><a href="#cb13-35" tabindex="-1"></a><span class="co"># ajuste en la muestra training</span></span>
<span id="cb13-36"><a href="#cb13-36" tabindex="-1"></a>fit1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(ofp <span class="sc">~</span> </span>
<span id="cb13-37"><a href="#cb13-37" tabindex="-1"></a>              </span>
<span id="cb13-38"><a href="#cb13-38" tabindex="-1"></a>              hosp <span class="sc">+</span> </span>
<span id="cb13-39"><a href="#cb13-39" tabindex="-1"></a>              health <span class="sc">+</span> </span>
<span id="cb13-40"><a href="#cb13-40" tabindex="-1"></a>              numchron <span class="sc">+</span> </span>
<span id="cb13-41"><a href="#cb13-41" tabindex="-1"></a>              <span class="co">#adldiff + </span></span>
<span id="cb13-42"><a href="#cb13-42" tabindex="-1"></a>              region <span class="sc">+</span> </span>
<span id="cb13-43"><a href="#cb13-43" tabindex="-1"></a>              age <span class="sc">+</span> </span>
<span id="cb13-44"><a href="#cb13-44" tabindex="-1"></a>              black <span class="sc">+</span> </span>
<span id="cb13-45"><a href="#cb13-45" tabindex="-1"></a>              gender <span class="sc">+</span> </span>
<span id="cb13-46"><a href="#cb13-46" tabindex="-1"></a>              married <span class="sc">+</span></span>
<span id="cb13-47"><a href="#cb13-47" tabindex="-1"></a>              school <span class="sc">+</span> </span>
<span id="cb13-48"><a href="#cb13-48" tabindex="-1"></a>              <span class="co">#faminc + </span></span>
<span id="cb13-49"><a href="#cb13-49" tabindex="-1"></a>              <span class="co">#employed + </span></span>
<span id="cb13-50"><a href="#cb13-50" tabindex="-1"></a>              privins <span class="sc">+</span> </span>
<span id="cb13-51"><a href="#cb13-51" tabindex="-1"></a>              medicaid</span>
<span id="cb13-52"><a href="#cb13-52" tabindex="-1"></a>            </span>
<span id="cb13-53"><a href="#cb13-53" tabindex="-1"></a>            ,<span class="at">family=</span>poisson, <span class="at">data=</span>xx.train)</span>
<span id="cb13-54"><a href="#cb13-54" tabindex="-1"></a></span>
<span id="cb13-55"><a href="#cb13-55" tabindex="-1"></a></span>
<span id="cb13-56"><a href="#cb13-56" tabindex="-1"></a>fit.pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit1, <span class="at">newdata=</span>xx.test, <span class="at">type=</span><span class="st">&quot;response&quot;</span>)</span>
<span id="cb13-57"><a href="#cb13-57" tabindex="-1"></a></span>
<span id="cb13-58"><a href="#cb13-58" tabindex="-1"></a></span>
<span id="cb13-59"><a href="#cb13-59" tabindex="-1"></a><span class="fu">MsE</span> (xx.test[,<span class="st">&quot;ofp&quot;</span>], fit.pred)</span>
<span id="cb13-60"><a href="#cb13-60" tabindex="-1"></a></span>
<span id="cb13-61"><a href="#cb13-61" tabindex="-1"></a></span>
<span id="cb13-62"><a href="#cb13-62" tabindex="-1"></a></span>
<span id="cb13-63"><a href="#cb13-63" tabindex="-1"></a><span class="co"># indicador honesto en la muestra de testing</span></span>
<span id="cb13-64"><a href="#cb13-64" tabindex="-1"></a>fit.pred.train <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">predict</span>(fit1, <span class="at">newdata=</span>xx.train, <span class="at">type=</span><span class="st">&quot;response&quot;</span>),<span class="dv">0</span>)</span>
<span id="cb13-65"><a href="#cb13-65" tabindex="-1"></a></span>
<span id="cb13-66"><a href="#cb13-66" tabindex="-1"></a><span class="fu">MsE</span> (xx.train[,<span class="st">&quot;ofp&quot;</span>], fit.pred.train)</span>
<span id="cb13-67"><a href="#cb13-67" tabindex="-1"></a></span>
<span id="cb13-68"><a href="#cb13-68" tabindex="-1"></a></span>
<span id="cb13-69"><a href="#cb13-69" tabindex="-1"></a></span>
<span id="cb13-70"><a href="#cb13-70" tabindex="-1"></a><span class="co"># -------------------------- bootstraping ---------------------</span></span>
<span id="cb13-71"><a href="#cb13-71" tabindex="-1"></a></span>
<span id="cb13-72"><a href="#cb13-72" tabindex="-1"></a></span>
<span id="cb13-73"><a href="#cb13-73" tabindex="-1"></a><span class="fu">library</span>(asaur)</span>
<span id="cb13-74"><a href="#cb13-74" tabindex="-1"></a></span>
<span id="cb13-75"><a href="#cb13-75" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pharmacoSmoking&quot;</span>)</span>
<span id="cb13-76"><a href="#cb13-76" tabindex="-1"></a><span class="fu">head</span>(pharmacoSmoking)</span>
<span id="cb13-77"><a href="#cb13-77" tabindex="-1"></a></span>
<span id="cb13-78"><a href="#cb13-78" tabindex="-1"></a><span class="fu">names</span>(pharmacoSmoking)</span>
<span id="cb13-79"><a href="#cb13-79" tabindex="-1"></a></span>
<span id="cb13-80"><a href="#cb13-80" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb13-81"><a href="#cb13-81" tabindex="-1"></a>pharmacoSmoking<span class="sc">$</span>race2 <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(pharmacoSmoking<span class="sc">$</span>race, <span class="at">other =</span> <span class="fu">c</span>(<span class="st">&quot;hispanic&quot;</span>,<span class="st">&quot;other&quot;</span>), <span class="at">white =</span> <span class="st">&quot;white&quot;</span>, <span class="at">black =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb13-82"><a href="#cb13-82" tabindex="-1"></a></span>
<span id="cb13-83"><a href="#cb13-83" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> pharmacoSmoking[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">11</span>,<span class="dv">12</span>)]</span>
<span id="cb13-84"><a href="#cb13-84" tabindex="-1"></a></span>
<span id="cb13-85"><a href="#cb13-85" tabindex="-1"></a><span class="fu">dim</span>(dataset)</span>
<span id="cb13-86"><a href="#cb13-86" tabindex="-1"></a></span>
<span id="cb13-87"><a href="#cb13-87" tabindex="-1"></a><span class="do">## numbers of samples</span></span>
<span id="cb13-88"><a href="#cb13-88" tabindex="-1"></a>n.samples <span class="ot">=</span> <span class="dv">100</span></span>
<span id="cb13-89"><a href="#cb13-89" tabindex="-1"></a></span>
<span id="cb13-90"><a href="#cb13-90" tabindex="-1"></a><span class="do">## sample size</span></span>
<span id="cb13-91"><a href="#cb13-91" tabindex="-1"></a>n.all <span class="ot">=</span> <span class="fu">nrow</span> ( dataset )  </span>
<span id="cb13-92"><a href="#cb13-92" tabindex="-1"></a></span>
<span id="cb13-93"><a href="#cb13-93" tabindex="-1"></a></span>
<span id="cb13-94"><a href="#cb13-94" tabindex="-1"></a>f.error  <span class="ot">=</span> <span class="fu">rep</span> ( <span class="cn">NA</span>, n.samples )</span>
<span id="cb13-95"><a href="#cb13-95" tabindex="-1"></a>f.accuracy <span class="ot">&lt;-</span> <span class="fu">rep</span> ( <span class="cn">NA</span>, n.samples )</span>
<span id="cb13-96"><a href="#cb13-96" tabindex="-1"></a>f.auc   <span class="ot">=</span> <span class="fu">rep</span> ( <span class="cn">NA</span>, n.samples )</span>
<span id="cb13-97"><a href="#cb13-97" tabindex="-1"></a></span>
<span id="cb13-98"><a href="#cb13-98" tabindex="-1"></a><span class="co"># cutoff of classification</span></span>
<span id="cb13-99"><a href="#cb13-99" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb13-100"><a href="#cb13-100" tabindex="-1"></a></span>
<span id="cb13-101"><a href="#cb13-101" tabindex="-1"></a><span class="cf">for</span> ( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.samples )</span>
<span id="cb13-102"><a href="#cb13-102" tabindex="-1"></a>{ </span>
<span id="cb13-103"><a href="#cb13-103" tabindex="-1"></a>  </span>
<span id="cb13-104"><a href="#cb13-104" tabindex="-1"></a>  ind.boot <span class="ot">=</span> <span class="fu">sample</span> ( <span class="dv">1</span><span class="sc">:</span>n.all , <span class="at">replace=</span>T )</span>
<span id="cb13-105"><a href="#cb13-105" tabindex="-1"></a>  </span>
<span id="cb13-106"><a href="#cb13-106" tabindex="-1"></a>  xx.train <span class="ot">=</span> dataset [ ind.boot , ]       </span>
<span id="cb13-107"><a href="#cb13-107" tabindex="-1"></a>  xx.test  <span class="ot">=</span> dataset [ <span class="sc">-</span> ind.boot , ]     </span>
<span id="cb13-108"><a href="#cb13-108" tabindex="-1"></a>  <span class="fu">dim</span>(xx.train)</span>
<span id="cb13-109"><a href="#cb13-109" tabindex="-1"></a>  <span class="fu">dim</span>(xx.test)</span>
<span id="cb13-110"><a href="#cb13-110" tabindex="-1"></a>  </span>
<span id="cb13-111"><a href="#cb13-111" tabindex="-1"></a>  fit0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(relapse <span class="sc">~</span> </span>
<span id="cb13-112"><a href="#cb13-112" tabindex="-1"></a>               grp <span class="sc">+</span> </span>
<span id="cb13-113"><a href="#cb13-113" tabindex="-1"></a>               age <span class="sc">+</span></span>
<span id="cb13-114"><a href="#cb13-114" tabindex="-1"></a>               gender <span class="sc">+</span> </span>
<span id="cb13-115"><a href="#cb13-115" tabindex="-1"></a>               race2 <span class="sc">+</span> </span>
<span id="cb13-116"><a href="#cb13-116" tabindex="-1"></a>               employment <span class="sc">+</span></span>
<span id="cb13-117"><a href="#cb13-117" tabindex="-1"></a>               yearsSmoking <span class="sc">+</span> </span>
<span id="cb13-118"><a href="#cb13-118" tabindex="-1"></a>               levelSmoking <span class="sc">+</span> </span>
<span id="cb13-119"><a href="#cb13-119" tabindex="-1"></a>               priorAttempts <span class="sc">+</span></span>
<span id="cb13-120"><a href="#cb13-120" tabindex="-1"></a>               longestNoSmoke</span>
<span id="cb13-121"><a href="#cb13-121" tabindex="-1"></a>             </span>
<span id="cb13-122"><a href="#cb13-122" tabindex="-1"></a>             , <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>xx.train)</span>
<span id="cb13-123"><a href="#cb13-123" tabindex="-1"></a>  </span>
<span id="cb13-124"><a href="#cb13-124" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">direcction =</span> <span class="st">&quot;both&quot;</span>)</span>
<span id="cb13-125"><a href="#cb13-125" tabindex="-1"></a>  </span>
<span id="cb13-126"><a href="#cb13-126" tabindex="-1"></a>  </span>
<span id="cb13-127"><a href="#cb13-127" tabindex="-1"></a>  <span class="co"># predict probabilities in test</span></span>
<span id="cb13-128"><a href="#cb13-128" tabindex="-1"></a>  prob.pred.test <span class="ot">=</span> <span class="fu">predict</span> ( fit , <span class="at">newdata=</span>xx.test , <span class="at">type=</span><span class="st">&quot;response&quot;</span> )</span>
<span id="cb13-129"><a href="#cb13-129" tabindex="-1"></a>  </span>
<span id="cb13-130"><a href="#cb13-130" tabindex="-1"></a>  <span class="co"># classification in test</span></span>
<span id="cb13-131"><a href="#cb13-131" tabindex="-1"></a>  class.pred.test <span class="ot">=</span> <span class="fu">as.numeric</span> ( prob.pred.test <span class="sc">&gt;</span> p0 )</span>
<span id="cb13-132"><a href="#cb13-132" tabindex="-1"></a>  </span>
<span id="cb13-133"><a href="#cb13-133" tabindex="-1"></a>  </span>
<span id="cb13-134"><a href="#cb13-134" tabindex="-1"></a>  f.error [i] <span class="ot">=</span> <span class="fu">ErrorRate</span> ( xx.test<span class="sc">$</span>relapse, class.pred.test )<span class="sc">$</span>Error.rate </span>
<span id="cb13-135"><a href="#cb13-135" tabindex="-1"></a>  f.accuracy [i] <span class="ot">=</span> <span class="fu">ErrorRate</span> ( xx.test<span class="sc">$</span>relapse, class.pred.test )<span class="sc">$</span>Accuracy</span>
<span id="cb13-136"><a href="#cb13-136" tabindex="-1"></a>  f.auc [i]   <span class="ot">=</span> <span class="fu">ROCarea</span> ( xx.test<span class="sc">$</span>relapse, prob.pred.test)<span class="sc">$</span>AUC</span>
<span id="cb13-137"><a href="#cb13-137" tabindex="-1"></a>}</span>
<span id="cb13-138"><a href="#cb13-138" tabindex="-1"></a></span>
<span id="cb13-139"><a href="#cb13-139" tabindex="-1"></a>  <span class="fu">mean</span>(f.error)           </span>
<span id="cb13-140"><a href="#cb13-140" tabindex="-1"></a>    </span>
<span id="cb13-141"><a href="#cb13-141" tabindex="-1"></a>  </span>
<span id="cb13-142"><a href="#cb13-142" tabindex="-1"></a>  <span class="fu">mean</span>(f.accuracy)</span>
<span id="cb13-143"><a href="#cb13-143" tabindex="-1"></a>  </span>
<span id="cb13-144"><a href="#cb13-144" tabindex="-1"></a>  <span class="fu">mean</span>(f.auc)</span>
<span id="cb13-145"><a href="#cb13-145" tabindex="-1"></a>                </span>
<span id="cb13-146"><a href="#cb13-146" tabindex="-1"></a>                </span>
<span id="cb13-147"><a href="#cb13-147" tabindex="-1"></a><span class="co"># ------------------------ validacion cruzada ---------------------                </span></span>
<span id="cb13-148"><a href="#cb13-148" tabindex="-1"></a>        </span>
<span id="cb13-149"><a href="#cb13-149" tabindex="-1"></a><span class="fu">library</span>(asaur)</span>
<span id="cb13-150"><a href="#cb13-150" tabindex="-1"></a></span>
<span id="cb13-151"><a href="#cb13-151" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;pharmacoSmoking&quot;</span>)</span>
<span id="cb13-152"><a href="#cb13-152" tabindex="-1"></a><span class="fu">head</span>(pharmacoSmoking)</span>
<span id="cb13-153"><a href="#cb13-153" tabindex="-1"></a></span>
<span id="cb13-154"><a href="#cb13-154" tabindex="-1"></a><span class="fu">names</span>(pharmacoSmoking)</span>
<span id="cb13-155"><a href="#cb13-155" tabindex="-1"></a></span>
<span id="cb13-156"><a href="#cb13-156" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb13-157"><a href="#cb13-157" tabindex="-1"></a>pharmacoSmoking<span class="sc">$</span>race2 <span class="ot">&lt;-</span> <span class="fu">fct_collapse</span>(pharmacoSmoking<span class="sc">$</span>race, <span class="at">other =</span> <span class="fu">c</span>(<span class="st">&quot;hispanic&quot;</span>,<span class="st">&quot;other&quot;</span>),</span>
<span id="cb13-158"><a href="#cb13-158" tabindex="-1"></a>                                      <span class="at">white =</span> <span class="st">&quot;white&quot;</span>, <span class="at">black =</span> <span class="st">&quot;black&quot;</span>)</span>
<span id="cb13-159"><a href="#cb13-159" tabindex="-1"></a><span class="fu">names</span>(pharmacoSmoking)</span>
<span id="cb13-160"><a href="#cb13-160" tabindex="-1"></a></span>
<span id="cb13-161"><a href="#cb13-161" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> pharmacoSmoking[,<span class="sc">-</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">7</span>,<span class="dv">11</span>,<span class="dv">12</span>)]</span>
<span id="cb13-162"><a href="#cb13-162" tabindex="-1"></a></span>
<span id="cb13-163"><a href="#cb13-163" tabindex="-1"></a>              </span>
<span id="cb13-164"><a href="#cb13-164" tabindex="-1"></a>n.cv <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb13-165"><a href="#cb13-165" tabindex="-1"></a>n.times <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb13-166"><a href="#cb13-166" tabindex="-1"></a>n.all <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataset)</span>
<span id="cb13-167"><a href="#cb13-167" tabindex="-1"></a></span>
<span id="cb13-168"><a href="#cb13-168" tabindex="-1"></a><span class="co"># cutoff of classification</span></span>
<span id="cb13-169"><a href="#cb13-169" tabindex="-1"></a>p0 <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb13-170"><a href="#cb13-170" tabindex="-1"></a>             </span>
<span id="cb13-171"><a href="#cb13-171" tabindex="-1"></a>f.error <span class="ot">&lt;-</span> f.accuracy <span class="ot">&lt;-</span> f.auc <span class="ot">&lt;-</span> <span class="fu">matrix</span> (<span class="cn">NA</span>, n.times, n.cv)</span>
<span id="cb13-172"><a href="#cb13-172" tabindex="-1"></a></span>
<span id="cb13-173"><a href="#cb13-173" tabindex="-1"></a>              </span>
<span id="cb13-174"><a href="#cb13-174" tabindex="-1"></a><span class="co"># progress bar</span></span>
<span id="cb13-175"><a href="#cb13-175" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> n.times, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb13-176"><a href="#cb13-176" tabindex="-1"></a></span>
<span id="cb13-177"><a href="#cb13-177" tabindex="-1"></a>                </span>
<span id="cb13-178"><a href="#cb13-178" tabindex="-1"></a><span class="cf">for</span> (times <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.times){</span>
<span id="cb13-179"><a href="#cb13-179" tabindex="-1"></a>  </span>
<span id="cb13-180"><a href="#cb13-180" tabindex="-1"></a>  <span class="co"># sampling</span></span>
<span id="cb13-181"><a href="#cb13-181" tabindex="-1"></a>  groups <span class="ot">&lt;-</span> <span class="fu">sample</span>( <span class="fu">rep</span>( <span class="dv">1</span><span class="sc">:</span>n.cv, <span class="at">lenght=</span>n.all))</span>
<span id="cb13-182"><a href="#cb13-182" tabindex="-1"></a>  </span>
<span id="cb13-183"><a href="#cb13-183" tabindex="-1"></a>  <span class="co"># cv</span></span>
<span id="cb13-184"><a href="#cb13-184" tabindex="-1"></a>  <span class="cf">for</span> (ind.cv <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n.cv){</span>
<span id="cb13-185"><a href="#cb13-185" tabindex="-1"></a>    </span>
<span id="cb13-186"><a href="#cb13-186" tabindex="-1"></a>    <span class="fu">setWinProgressBar</span>(pb, times, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(times<span class="sc">/</span>n.times<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="st">&quot;% done&quot;</span>, times, <span class="st">&quot;/&quot;</span>, n.times))</span>
<span id="cb13-187"><a href="#cb13-187" tabindex="-1"></a>    </span>
<span id="cb13-188"><a href="#cb13-188" tabindex="-1"></a>    <span class="co"># datasets</span></span>
<span id="cb13-189"><a href="#cb13-189" tabindex="-1"></a>    cv.train <span class="ot">=</span> dataset[groups <span class="sc">!=</span> ind.cv , ]</span>
<span id="cb13-190"><a href="#cb13-190" tabindex="-1"></a>    cv.test  <span class="ot">=</span> dataset[groups <span class="sc">==</span> ind.cv , ]</span>
<span id="cb13-191"><a href="#cb13-191" tabindex="-1"></a>    </span>
<span id="cb13-192"><a href="#cb13-192" tabindex="-1"></a>    fit0 <span class="ot">&lt;-</span> <span class="fu">glm</span>(relapse <span class="sc">~</span> </span>
<span id="cb13-193"><a href="#cb13-193" tabindex="-1"></a>                  grp <span class="sc">+</span> </span>
<span id="cb13-194"><a href="#cb13-194" tabindex="-1"></a>                  age <span class="sc">+</span></span>
<span id="cb13-195"><a href="#cb13-195" tabindex="-1"></a>                  gender <span class="sc">+</span> </span>
<span id="cb13-196"><a href="#cb13-196" tabindex="-1"></a>                  race2 <span class="sc">+</span> </span>
<span id="cb13-197"><a href="#cb13-197" tabindex="-1"></a>                  employment <span class="sc">+</span></span>
<span id="cb13-198"><a href="#cb13-198" tabindex="-1"></a>                  yearsSmoking <span class="sc">+</span> </span>
<span id="cb13-199"><a href="#cb13-199" tabindex="-1"></a>                  levelSmoking <span class="sc">+</span> </span>
<span id="cb13-200"><a href="#cb13-200" tabindex="-1"></a>                  priorAttempts <span class="sc">+</span></span>
<span id="cb13-201"><a href="#cb13-201" tabindex="-1"></a>                  longestNoSmoke</span>
<span id="cb13-202"><a href="#cb13-202" tabindex="-1"></a>                </span>
<span id="cb13-203"><a href="#cb13-203" tabindex="-1"></a>                , <span class="at">family=</span><span class="fu">binomial</span>(logit), <span class="at">data=</span>cv.train)</span>
<span id="cb13-204"><a href="#cb13-204" tabindex="-1"></a>    </span>
<span id="cb13-205"><a href="#cb13-205" tabindex="-1"></a>    fit <span class="ot">&lt;-</span> <span class="fu">step</span>(fit0, <span class="at">direcction =</span> <span class="st">&quot;both&quot;</span>)</span>
<span id="cb13-206"><a href="#cb13-206" tabindex="-1"></a>    </span>
<span id="cb13-207"><a href="#cb13-207" tabindex="-1"></a>    </span>
<span id="cb13-208"><a href="#cb13-208" tabindex="-1"></a>    <span class="co"># predict probabilities</span></span>
<span id="cb13-209"><a href="#cb13-209" tabindex="-1"></a>    prob.pred.test <span class="ot">=</span> <span class="fu">predict</span> ( fit , <span class="at">newdata=</span>cv.test , <span class="at">type=</span><span class="st">&quot;response&quot;</span> )</span>
<span id="cb13-210"><a href="#cb13-210" tabindex="-1"></a>    </span>
<span id="cb13-211"><a href="#cb13-211" tabindex="-1"></a>    </span>
<span id="cb13-212"><a href="#cb13-212" tabindex="-1"></a>    <span class="co"># classification</span></span>
<span id="cb13-213"><a href="#cb13-213" tabindex="-1"></a>    class.pred.test <span class="ot">=</span> <span class="fu">as.numeric</span> ( prob.pred.test <span class="sc">&gt;</span> p0 )</span>
<span id="cb13-214"><a href="#cb13-214" tabindex="-1"></a>    </span>
<span id="cb13-215"><a href="#cb13-215" tabindex="-1"></a>    f.error [times,ind.cv] <span class="ot">=</span> <span class="fu">ErrorRate</span> ( cv.test<span class="sc">$</span>relapse, class.pred.test )<span class="sc">$</span>Error.rate </span>
<span id="cb13-216"><a href="#cb13-216" tabindex="-1"></a>    f.accuracy [times,ind.cv] <span class="ot">=</span> <span class="fu">ErrorRate</span> ( cv.test<span class="sc">$</span>relapse, class.pred.test )<span class="sc">$</span>Accuracy</span>
<span id="cb13-217"><a href="#cb13-217" tabindex="-1"></a>    f.auc [times,ind.cv]   <span class="ot">=</span> <span class="fu">ROCarea</span> ( cv.test<span class="sc">$</span>relapse, prob.pred.test)<span class="sc">$</span>AUC</span>
<span id="cb13-218"><a href="#cb13-218" tabindex="-1"></a>    </span>
<span id="cb13-219"><a href="#cb13-219" tabindex="-1"></a>    </span>
<span id="cb13-220"><a href="#cb13-220" tabindex="-1"></a>  }</span>
<span id="cb13-221"><a href="#cb13-221" tabindex="-1"></a>  </span>
<span id="cb13-222"><a href="#cb13-222" tabindex="-1"></a>}</span>
<span id="cb13-223"><a href="#cb13-223" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb13-224"><a href="#cb13-224" tabindex="-1"></a>       </span>
<span id="cb13-225"><a href="#cb13-225" tabindex="-1"></a></span>
<span id="cb13-226"><a href="#cb13-226" tabindex="-1"></a>error.rate <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(f.error),<span class="dv">3</span>)</span>
<span id="cb13-227"><a href="#cb13-227" tabindex="-1"></a>accuracy.rate <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(f.accuracy),<span class="dv">3</span>)</span>
<span id="cb13-228"><a href="#cb13-228" tabindex="-1"></a></span>
<span id="cb13-229"><a href="#cb13-229" tabindex="-1"></a>auc_honest <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">mean</span>(f.auc),<span class="dv">3</span>)</span>
<span id="cb13-230"><a href="#cb13-230" tabindex="-1"></a>sd.auc <span class="ot">&lt;-</span> <span class="fu">sd</span>(<span class="fu">as.vector</span>(f.auc))</span>
<span id="cb13-231"><a href="#cb13-231" tabindex="-1"></a>AIC.auc <span class="ot">&lt;-</span> <span class="fu">round</span> (auc_honest <span class="sc">-</span>  <span class="fl">1.96</span><span class="sc">*</span>sd.auc, <span class="dv">3</span>)</span>
<span id="cb13-232"><a href="#cb13-232" tabindex="-1"></a>BIC.auc <span class="ot">&lt;-</span> <span class="fu">round</span> (auc_honest <span class="sc">+</span>  <span class="fl">1.96</span><span class="sc">*</span>sd.auc, <span class="dv">3</span>)</span>
<span id="cb13-233"><a href="#cb13-233" tabindex="-1"></a></span>
<span id="cb13-234"><a href="#cb13-234" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">auc_honest=</span>auc_honest, <span class="at">IC95=</span><span class="fu">paste</span>(<span class="st">&quot;(&quot;</span>,AIC.auc,<span class="st">&quot;-&quot;</span>,BIC.auc,<span class="st">&quot;)&quot;</span>,<span class="at">sep=</span><span class="st">&quot;&quot;</span>),</span>
<span id="cb13-235"><a href="#cb13-235" tabindex="-1"></a>           <span class="at">Err.rate=</span>error.rate, <span class="at">Accuracy.rate=</span>accuracy.rate)</span></code></pre></div>
</div>
<div id="iii-anexos" class="section level2">
<h2>III ANEXOS</h2>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co"># ----------------------------- BARRA DE PROGRESO --------------------------</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="co">#number of loop iterations</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>niter <span class="ot">&lt;-</span> <span class="fu">length</span>(dataset)</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a><span class="co"># creating process bar outside the loop</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> niter, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>niter) {</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a><span class="fu">setWinProgressBar</span>(pb, i, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(i<span class="sc">/</span>niter<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="st">&quot;% done&quot;</span>, i, <span class="st">&quot;/&quot;</span>, niter))</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># ADD CODE</span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a></span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>}</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a><span class="co"># -------------------------------------------</span></span>
<span id="cb14-21"><a href="#cb14-21" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100000</span>, <span class="at">mean=</span><span class="dv">90</span>, <span class="at">sd=</span><span class="dv">5</span>)</span>
<span id="cb14-23"><a href="#cb14-23" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">100000</span>, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb14-25"><a href="#cb14-25" tabindex="-1"></a>y <span class="ot">&lt;-</span> x <span class="sc">+</span> e</span>
<span id="cb14-26"><a href="#cb14-26" tabindex="-1"></a></span>
<span id="cb14-27"><a href="#cb14-27" tabindex="-1"></a>dataset <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">y=</span>y,<span class="at">x=</span>x)</span>
<span id="cb14-28"><a href="#cb14-28" tabindex="-1"></a></span>
<span id="cb14-29"><a href="#cb14-29" tabindex="-1"></a>niter <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># number of iteractions</span></span>
<span id="cb14-30"><a href="#cb14-30" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" tabindex="-1"></a>MSR <span class="ot">&lt;-</span> <span class="fu">vector</span>()</span>
<span id="cb14-32"><a href="#cb14-32" tabindex="-1"></a></span>
<span id="cb14-33"><a href="#cb14-33" tabindex="-1"></a><span class="co"># creating process bar outside the loop</span></span>
<span id="cb14-34"><a href="#cb14-34" tabindex="-1"></a>pb <span class="ot">&lt;-</span> <span class="fu">winProgressBar</span>(<span class="at">title =</span> <span class="st">&quot;progress bar&quot;</span>, <span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> niter, <span class="at">width =</span> <span class="dv">300</span>)</span>
<span id="cb14-35"><a href="#cb14-35" tabindex="-1"></a></span>
<span id="cb14-36"><a href="#cb14-36" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>niter){</span>
<span id="cb14-37"><a href="#cb14-37" tabindex="-1"></a>  </span>
<span id="cb14-38"><a href="#cb14-38" tabindex="-1"></a>  <span class="fu">setWinProgressBar</span>(pb, i, <span class="at">title=</span><span class="fu">paste</span>( <span class="fu">round</span>(i<span class="sc">/</span>niter<span class="sc">*</span><span class="dv">100</span>, <span class="dv">0</span>), <span class="st">&quot;% done&quot;</span>, i, <span class="st">&quot;/&quot;</span>, niter))</span>
<span id="cb14-39"><a href="#cb14-39" tabindex="-1"></a>  </span>
<span id="cb14-40"><a href="#cb14-40" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n,<span class="at">size=</span><span class="dv">10000</span>,<span class="at">replace=</span><span class="cn">FALSE</span>)</span>
<span id="cb14-41"><a href="#cb14-41" tabindex="-1"></a>  dataset.sub <span class="ot">&lt;-</span> dataset[ind,]</span>
<span id="cb14-42"><a href="#cb14-42" tabindex="-1"></a>  </span>
<span id="cb14-43"><a href="#cb14-43" tabindex="-1"></a>  fit.lm <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data=</span>dataset.sub)</span>
<span id="cb14-44"><a href="#cb14-44" tabindex="-1"></a>  </span>
<span id="cb14-45"><a href="#cb14-45" tabindex="-1"></a>  MSR[i] <span class="ot">&lt;-</span> (<span class="fu">sum</span>(<span class="fu">fitted</span>(fit.lm)<span class="sc">-</span>y)<span class="sc">^</span><span class="dv">2</span> )<span class="sc">/</span><span class="dv">1000</span></span>
<span id="cb14-46"><a href="#cb14-46" tabindex="-1"></a>  </span>
<span id="cb14-47"><a href="#cb14-47" tabindex="-1"></a>}</span>
<span id="cb14-48"><a href="#cb14-48" tabindex="-1"></a><span class="fu">close</span>(pb)</span>
<span id="cb14-49"><a href="#cb14-49" tabindex="-1"></a></span>
<span id="cb14-50"><a href="#cb14-50" tabindex="-1"></a></span>
<span id="cb14-51"><a href="#cb14-51" tabindex="-1"></a><span class="fu">mean</span>(MSR)</span>
<span id="cb14-52"><a href="#cb14-52" tabindex="-1"></a></span>
<span id="cb14-53"><a href="#cb14-53" tabindex="-1"></a></span>
<span id="cb14-54"><a href="#cb14-54" tabindex="-1"></a><span class="co"># ----------------------------CURVA SUAVIZADA -----------------------------------</span></span>
<span id="cb14-55"><a href="#cb14-55" tabindex="-1"></a></span>
<span id="cb14-56"><a href="#cb14-56" tabindex="-1"></a>smoothSEcurve <span class="ot">&lt;-</span> <span class="cf">function</span> (yy,xx) {</span>
<span id="cb14-57"><a href="#cb14-57" tabindex="-1"></a></span>
<span id="cb14-58"><a href="#cb14-58" tabindex="-1"></a><span class="co"># is used after a plot call</span></span>
<span id="cb14-59"><a href="#cb14-59" tabindex="-1"></a><span class="co"># fit a smooth lowess curve and its CI95%</span></span>
<span id="cb14-60"><a href="#cb14-60" tabindex="-1"></a></span>
<span id="cb14-61"><a href="#cb14-61" tabindex="-1"></a><span class="co"># make a list of the variables x</span></span>
<span id="cb14-62"><a href="#cb14-62" tabindex="-1"></a>xx.list <span class="ot">&lt;-</span> <span class="fu">min</span>(xx) <span class="sc">+</span> ( (<span class="dv">0</span><span class="sc">:</span><span class="dv">100</span>) <span class="sc">/</span> <span class="dv">100</span>) <span class="sc">*</span> ( <span class="fu">max</span>(xx) <span class="sc">-</span> <span class="fu">min</span>(xx) )</span>
<span id="cb14-63"><a href="#cb14-63" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" tabindex="-1"></a><span class="co"># fit the loess function at the points (xx,yy)</span></span>
<span id="cb14-65"><a href="#cb14-65" tabindex="-1"></a>yy.xx <span class="ot">&lt;-</span> <span class="fu">predict</span>(<span class="fu">loess</span>(yy <span class="sc">~</span> xx), <span class="at">se=</span>T, <span class="at">newdata=</span><span class="fu">data.frame</span>(<span class="at">xx=</span>xx.list))</span>
<span id="cb14-66"><a href="#cb14-66" tabindex="-1"></a></span>
<span id="cb14-67"><a href="#cb14-67" tabindex="-1"></a><span class="fu">lines</span>(yy.xx<span class="sc">$</span>fit <span class="sc">~</span> xx.list, <span class="at">lwd=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;blue&quot;</span>)</span>
<span id="cb14-68"><a href="#cb14-68" tabindex="-1"></a><span class="fu">lines</span>(yy.xx<span class="sc">$</span>fit <span class="sc">-</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, yy.xx<span class="sc">$</span>df) <span class="sc">*</span> yy.xx<span class="sc">$</span>se.fit <span class="sc">~</span> xx.list, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-69"><a href="#cb14-69" tabindex="-1"></a><span class="fu">lines</span>(yy.xx<span class="sc">$</span>fit <span class="sc">+</span> <span class="fu">qt</span>(<span class="fl">0.975</span>, yy.xx<span class="sc">$</span>df) <span class="sc">*</span> yy.xx<span class="sc">$</span>se.fit <span class="sc">~</span> xx.list, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-70"><a href="#cb14-70" tabindex="-1"></a>}</span>
<span id="cb14-71"><a href="#cb14-71" tabindex="-1"></a></span>
<span id="cb14-72"><a href="#cb14-72" tabindex="-1"></a></span>
<span id="cb14-73"><a href="#cb14-73" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean=</span><span class="dv">10</span>, <span class="at">sd=</span><span class="dv">10</span>)</span>
<span id="cb14-74"><a href="#cb14-74" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">1000</span>, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">10</span>)</span>
<span id="cb14-75"><a href="#cb14-75" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">0.05</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span>  <span class="sc">+</span> e</span>
<span id="cb14-76"><a href="#cb14-76" tabindex="-1"></a></span>
<span id="cb14-77"><a href="#cb14-77" tabindex="-1"></a><span class="fu">plot</span>(y <span class="sc">~</span> x)</span>
<span id="cb14-78"><a href="#cb14-78" tabindex="-1"></a><span class="fu">smoothSEcurve</span>(y,x)</span>
<span id="cb14-79"><a href="#cb14-79" tabindex="-1"></a></span>
<span id="cb14-80"><a href="#cb14-80" tabindex="-1"></a></span>
<span id="cb14-81"><a href="#cb14-81" tabindex="-1"></a><span class="co"># ----------------------------- TABULACION DE DATOS ------------------------------</span></span>
<span id="cb14-82"><a href="#cb14-82" tabindex="-1"></a></span>
<span id="cb14-83"><a href="#cb14-83" tabindex="-1"></a></span>
<span id="cb14-84"><a href="#cb14-84" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb14-85"><a href="#cb14-85" tabindex="-1"></a><span class="fu">library</span>(tables)</span>
<span id="cb14-86"><a href="#cb14-86" tabindex="-1"></a></span>
<span id="cb14-87"><a href="#cb14-87" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sex=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">6</span>,<span class="dv">6</span>,<span class="dv">6</span>), <span class="at">area=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">g.age=</span><span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">18</span>,<span class="dv">8</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>), <span class="at">one=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">delete.var =</span><span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">44</span>,<span class="dv">55</span>,<span class="dv">66</span>,<span class="dv">77</span>,<span class="dv">88</span>))</span>
<span id="cb14-88"><a href="#cb14-88" tabindex="-1"></a></span>
<span id="cb14-89"><a href="#cb14-89" tabindex="-1"></a>df</span>
<span id="cb14-90"><a href="#cb14-90" tabindex="-1"></a></span>
<span id="cb14-91"><a href="#cb14-91" tabindex="-1"></a></span>
<span id="cb14-92"><a href="#cb14-92" tabindex="-1"></a>keeps <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;g.age&quot;</span>,<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;area&quot;</span>,<span class="st">&quot;one&quot;</span>)</span>
<span id="cb14-93"><a href="#cb14-93" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> df[keeps]</span>
<span id="cb14-94"><a href="#cb14-94" tabindex="-1"></a></span>
<span id="cb14-95"><a href="#cb14-95" tabindex="-1"></a>df2</span>
<span id="cb14-96"><a href="#cb14-96" tabindex="-1"></a></span>
<span id="cb14-97"><a href="#cb14-97" tabindex="-1"></a></span>
<span id="cb14-98"><a href="#cb14-98" tabindex="-1"></a>agre <span class="ot">&lt;-</span> <span class="fu">aggregate</span>(one <span class="sc">~</span> g.age <span class="sc">+</span> sex <span class="sc">+</span> area , <span class="at">data=</span>df2, <span class="at">FUN=</span>sum)</span>
<span id="cb14-99"><a href="#cb14-99" tabindex="-1"></a></span>
<span id="cb14-100"><a href="#cb14-100" tabindex="-1"></a>agre</span>
<span id="cb14-101"><a href="#cb14-101" tabindex="-1"></a></span>
<span id="cb14-102"><a href="#cb14-102" tabindex="-1"></a>df.tab <span class="ot">&lt;-</span> <span class="fu">reshape</span>(agre, <span class="at">timevar=</span><span class="st">&quot;g.age&quot;</span>,<span class="at">idvar=</span><span class="fu">c</span>(<span class="st">&quot;sex&quot;</span>,<span class="st">&quot;area&quot;</span>), </span>
<span id="cb14-103"><a href="#cb14-103" tabindex="-1"></a>                     <span class="at">direction=</span><span class="st">&quot;wide&quot;</span>)</span>
<span id="cb14-104"><a href="#cb14-104" tabindex="-1"></a></span>
<span id="cb14-105"><a href="#cb14-105" tabindex="-1"></a>df.tab</span>
<span id="cb14-106"><a href="#cb14-106" tabindex="-1"></a></span>
<span id="cb14-107"><a href="#cb14-107" tabindex="-1"></a>df.tab[<span class="fu">is.na</span>(df.tab)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb14-108"><a href="#cb14-108" tabindex="-1"></a></span>
<span id="cb14-109"><a href="#cb14-109" tabindex="-1"></a>df.tab</span></code></pre></div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
